<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>State Exhibition — New Prosecution Laws 2024</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      background: linear-gradient(135deg, #e0f2fe 0%, #fef3c7 100%);
      font-family: 'Inter', sans-serif;
    }
    .fade-in {
      animation: fadeIn 0.8s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .input-group {
      transition: all 0.3s ease;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 16px;
      background: white;
    }
    .input-group:hover {
      border-color: #cbd5e1;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .section-header {
      font-weight: 600;
      color: #3182ce;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

  <div class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl fade-in overflow-hidden">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-800 to-indigo-600 text-white p-6 text-center">
      <h1 class="text-2xl font-bold mb-1">State Exhibition on New Prosecution Laws – 2024</h1>
      <p class="text-blue-100">AI Chatbot powered by Groq + Llama 3.3</p>
    </div>

    <!-- Form -->
    <div class="p-6 space-y-6">
      <!-- Name Field -->
      <div class="input-group border-l-4 border-l-blue-500">
        <div class="section-header">
          <i data-lucide="user" class="w-4 h-4"></i>
          Your Name (Optional)
        </div>
        <input 
          id="name" 
          class="w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 p-3 text-gray-800 transition"
          placeholder="e.g., Rajesh Kumar"
        />
      </div>

      <!-- Sample Questions -->
      <div class="input-group border-l-4 border-l-green-500">
        <div class="section-header">
          <i data-lucide="book-open" class="w-4 h-4"></i>
          Select a Ready Question
        </div>
        <div id="sampleQuestions" class="max-h-56 overflow-y-auto mt-3 space-y-2"></div>
      </div>

      <!-- Custom Question -->
      <div class="input-group border-l-4 border-l-teal-500">
        <div class="section-header">
          <i data-lucide="message-circle" class="w-4 h-4"></i>
          Your Own Question
        </div>
        <textarea 
          id="question" 
          rows="4" 
          class="w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 p-3 text-gray-800 transition mt-2"
          placeholder="Type your custom question..."
        ></textarea>
      </div>

      <!-- Language Selector -->
      <div class="input-group border-l-4 border-l-purple-500">
        <div class="section-header">
          <i data-lucide="globe" class="w-4 h-4"></i>
          Answer Language
        </div>
        <div class="flex flex-wrap gap-2 mt-2">
          <button class="langBtn px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition active" data-lang="English">
            English
          </button>
          <button class="langBtn px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition" data-lang="Hindi">
            हिंदी
          </button>
          <button class="langBtn px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition" data-lang="Punjabi">
            ਪੰਜਾਬੀ
          </button>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-3 pt-2">
        <button id="submitBtn" class="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-xl shadow-md transition flex-1 min-w-[140px]">
          <i data-lucide="send" class="w-4 h-4"></i> Ask AI
        </button>
        <button id="voiceBtn" class="flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-xl shadow-md transition flex-1 min-w-[140px]">
          <i data-lucide="mic" class="w-4 h-4"></i> Speak
        </button>
        <button id="mainPageBtn" class="flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-700 text-white px-5 py-3 rounded-xl shadow-md transition flex-1 min-w-[140px]">
          <i data-lucide="home" class="w-4 h-4"></i> Home
        </button>
      </div>
      
      <div id="status" class="text-center text-gray-500 min-h-[20px]"></div>
    </div>

    <!-- Footer -->
    <footer style="text-align:center; font-size:13px; color:#666; margin-top:30px; padding:12px; border-top:1px solid #ccc;">
      <p><strong>Disclaimer:</strong> This is an AI-generated response. Accuracy is not guaranteed and the content may be based on outdated information. Please verify through official sources.</p>
      <p>Designed by <strong>NIC, Kurukshetra</strong> for <strong>District Administration, Kurukshetra</strong></p>
      <p>Last Modified: <span id="lastModified"></span></p>
    </footer>
  </div>

  <!-- Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 fade-in">
      <div class="flex justify-between items-center border-b px-5 py-3 bg-blue-700 text-white rounded-t-2xl">
        <h2 class="text-lg font-semibold flex items-center gap-2"><i data-lucide="message-circle"></i> AI Response</h2>
        <button id="closeModal" class="hover:text-gray-200"><i data-lucide="x"></i></button>
      </div>
      <div class="p-5 max-h-[70vh] overflow-y-auto">
        <p class="font-semibold text-gray-700 mb-2">Question:</p>
        <pre id="userQuestion" class="whitespace-pre-wrap text-gray-800 mb-4"></pre>
        <p class="font-semibold text-gray-700 mb-2">Answer:</p>
        <pre id="aiAnswer" class="whitespace-pre-wrap text-gray-800"></pre>
      </div>
      <div class="border-t p-4 flex justify-end gap-3">
        <button id="copyBtn" class="flex items-center gap-1 px-4 py-2 border rounded-lg hover:bg-gray-100 transition"><i data-lucide="copy"></i> Copy</button>
        <button id="mainPageModalBtn" class="flex items-center gap-1 px-4 py-2 border rounded-lg hover:bg-gray-100 transition"><i data-lucide="home"></i> Main Page</button>
        <button id="closeBtn" class="bg-blue-700 text-white px-5 py-2 rounded-lg hover:bg-blue-800 transition">Close</button>
      </div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    // Last modified date
    document.getElementById("lastModified").textContent = new Date(document.lastModified).toLocaleString();

    const WEBHOOK_URL = 'https://aarvisingla1609.app.n8n.cloud/webhook/ai-answer';

    const samples = [
      "What are the three new prosecution laws implemented since 2024?",
      "How have the new laws changed the FIR process?",
      "Are bail provisions modified under the new system?",
      "How are cybercrimes treated under the new prosecution laws?",
      "What changes exist in the evidence collection process?",
      "Do victims get more rights or faster justice now?",
      "Are new offences introduced or penalties enhanced?",
      "How do the new laws ensure speedy trials?",
      "Do these laws affect existing criminal cases?",
      "Any changes to police powers or arrest procedures?",
      "What about reforms in case hearings and appeals?",
      "How are economic crimes handled differently?",
      "Do these laws simplify court processes?",
      "Is digital submission of evidence allowed now?",
      "What are the main benefits for citizens?",
      "How do these laws support fair prosecution?",
      "Are there any guidelines for prosecutors?",
      "What are the penalties for delaying investigation?",
      "How can I access the official text of the laws?",
      "Do these laws align with constitutional rights?"
    ];

    const container = document.getElementById('sampleQuestions');
    samples.forEach((q, i) => {
      const id = `q${i}`;
      const div = document.createElement('div');
      div.className = 'flex items-start py-1';
      div.innerHTML = `
        <input type="radio" id="${id}" name="sampleQ" value="${q}" class="mt-1.5 text-blue-600 focus:ring-blue-600">
        <label for="${id}" class="ml-2 text-sm text-gray-700 cursor-pointer hover:text-blue-700">${q}</label>
      `;
      container.appendChild(div);
    });

    container.addEventListener('change', e => {
      if (e.target.name === 'sampleQ')
        document.getElementById('question').value = e.target.value;
    });

    const modal = document.getElementById('modal');
    const openModal = () => modal.classList.remove('hidden');
    const closeModal = () => modal.classList.add('hidden');
    document.getElementById('closeBtn').onclick = closeModal;
    document.getElementById('closeModal').onclick = closeModal;
    document.getElementById('mainPageBtn').onclick = () => window.location.href = 'index.html';
    document.getElementById('mainPageModalBtn').onclick = () => window.location.href = 'index.html';

    let selectedLanguage = 'English';
    document.querySelectorAll('.langBtn').forEach(btn => {
      btn.addEventListener('click', function() {
        selectedLanguage = this.dataset.lang;
        document.querySelectorAll('.langBtn').forEach(b => b.classList.replace('bg-blue-600', 'bg-gray-600'));
        this.classList.replace('bg-gray-600', 'bg-blue-600');
      });
    });

    document.getElementById('submitBtn').addEventListener('click', async () => {
      const name = document.getElementById('name').value.trim() || 'Visitor';
      const question = document.getElementById('question').value.trim();
      if (!question) {
        alert('Please enter a question');
        return;
      }

      document.getElementById('submitBtn').disabled = true;
      document.getElementById('status').textContent = 'Getting response...';

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, question, language: selectedLanguage })
        });

        let answerText = '';
        if (res.ok) {
          const data = await res.json();
          answerText = data.answer || data.error || "No answer received.";
        } else {
          answerText = `Error: ${res.status} ${res.statusText}`;
        }

        document.getElementById('userQuestion').textContent = question;
        document.getElementById('aiAnswer').textContent = answerText;
        openModal();
      } catch (err) {
        alert('Connection failed: ' + err.message);
      } finally {
        document.getElementById('submitBtn').disabled = false;
        document.getElementById('status').textContent = '';
      }
    });

    let recognition;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('question').value = transcript;
        document.getElementById('status').textContent = '';
        updateVoiceButton('mic', 'Speak');
      };

      recognition.onerror = (event) => {
        console.error('Voice error:', event.error);
        document.getElementById('status').textContent = 'Voice error: ' + event.error;
        updateVoiceButton('mic', 'Speak');
      };

      recognition.onend = () => {
        updateVoiceButton('mic', 'Speak');
      };
    }

    function updateVoiceButton(icon, text) {
      document.getElementById('voiceBtn').innerHTML = `<i data-lucide="${icon}" class="w-4 h-4"></i> <span>${text}</span>`;
      lucide.createIcons();
    }

    document.getElementById('voiceBtn').addEventListener('click', () => {
      if (!recognition) {
        alert('Voice input not supported. Try Chrome or Edge.');
        return;
      }

      const langMap = {
        'English': 'en-IN',
        'Hindi': 'hi-IN',
        'Punjabi': 'pa-IN'
      };
      recognition.lang = langMap[selectedLanguage] || 'en-IN';

      updateVoiceButton('mic-off', 'Listening...');
      document.getElementById('status').textContent = 'Listening... Speak now.';

      try {
        recognition.start();
      } catch (err) {
        console.error('Voice start error:', err);
        document.getElementById('status').textContent = 'Voice error: ' + err.message;
        updateVoiceButton('mic', 'Speak');
      }
    });

    document.getElementById('copyBtn').onclick = () => {
      navigator.clipboard.writeText(document.getElementById('aiAnswer').textContent);
      alert('Copied to clipboard');
    };
  </script>
</body>
</html>
