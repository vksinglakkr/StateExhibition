<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>State Exhibition — New Criminal Laws 2024</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      background: linear-gradient(135deg, #e0f2fe 0%, #fef3c7 100%);
      font-family: 'Inter', sans-serif;
    }
    .fade-in {
      animation: fadeIn 0.8s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

  <div class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl fade-in">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-800 to-indigo-600 text-white rounded-t-2xl p-6 text-center">
      <h1 class="text-2xl font-bold mb-2">State Exhibition on New Criminal Laws – 2024</h1>
      <p class="text-blue-100">AI Chatbot powered by Groq + Llama 3.3</p>
    </div>

    <!-- Form -->
    <div class="p-6 space-y-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
        <input id="name" class="w-full rounded-lg border-gray-300 focus:ring-2 focus:ring-blue-600 focus:border-blue-600 p-2" placeholder="e.g. Vinod Singla" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Select a question by category</label>
        <div id="sampleQuestions" class="max-h-80 overflow-y-auto border rounded-lg p-3 space-y-3 bg-gray-50"></div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Or type your own question</label>
        <textarea id="question" rows="4" class="w-full rounded-lg border-gray-300 focus:ring-2 focus:ring-blue-600 focus:border-blue-600 p-2" placeholder="Ask about BNS, BNSS, or BSA..."></textarea>
      </div>

      <!-- Language Selector -->
      <div class="flex items-center space-x-2">
        <span class="text-gray-700 font-medium">Answer Language:</span>
        <button class="langBtn px-3 py-1 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition" data-lang="English">English</button>
        <button class="langBtn px-3 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition" data-lang="Hindi">Hindi</button>
        <button class="langBtn px-3 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition" data-lang="Punjabi">Punjabi</button>
      </div>

      <div class="flex items-center space-x-4">
        <button id="submitBtn" class="flex items-center justify-center gap-2 bg-blue-700 text-white px-5 py-2 rounded-xl shadow hover:bg-blue-800 transition">
          <i data-lucide="send"></i> <span>Ask AI</span>
        </button>

        <!-- Voice Input Button -->
        <button id="voiceBtn" class="flex items-center justify-center gap-2 bg-green-600 text-white px-4 py-2 rounded-xl shadow hover:bg-green-700 transition">
          <i data-lucide="mic"></i> <span>Speak</span>
        </button>

        <button id="mainPageBtn" class="flex items-center justify-center gap-2 bg-gray-500 text-white px-5 py-2 rounded-xl shadow hover:bg-gray-600 transition">
          <i data-lucide="home"></i> <span>Main Page</span>
        </button>
        <span id="status" class="text-gray-500"></span>
      </div>
    </div>

    <!-- Footer -->
    <div class="border-t p-4 text-center text-sm text-gray-600">
      <div class="mb-1">
        <span class="font-medium">Developed & Maintained by:</span><br>
        <span class="text-blue-700">NIC, Kurukshetra</span> for District Administration, Kurukshetra
      </div>
      <div class="flex items-center justify-center mt-2">
        <i data-lucide="shield-check" class="w-4 h-4 mr-1 text-green-600"></i>
        <span>© 2024 State Exhibition | Informational Purpose Only</span>
      </div>
      <div class="mt-2 text-xs text-gray-500">
        Last Updated: <span id="lastUpdated">June 2024</span>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 fade-in">
      <div class="flex justify-between items-center border-b px-5 py-3 bg-blue-700 text-white rounded-t-2xl">
        <h2 class="text-lg font-semibold flex items-center gap-2"><i data-lucide="message-circle"></i> AI Response</h2>
        <button id="closeModal" class="hover:text-gray-200"><i data-lucide="x"></i></button>
      </div>
      <div class="p-5 max-h-[70vh] overflow-y-auto">
        <p class="font-semibold text-gray-700 mb-2">Question:</p>
        <pre id="userQuestion" class="whitespace-pre-wrap text-gray-800 mb-4"></pre>
        <p class="font-semibold text-gray-700 mb-2">Answer:</p>
        <pre id="aiAnswer" class="whitespace-pre-wrap text-gray-800"></pre>
      </div>
      <div class="border-t p-4 flex justify-end gap-3">
        <button id="copyBtn" class="flex items-center gap-1 px-4 py-2 border rounded-lg hover:bg-gray-100 transition"><i data-lucide="copy"></i> Copy</button>
        <button id="mainPageModalBtn" class="flex items-center gap-1 px-4 py-2 border rounded-lg hover:bg-gray-100 transition"><i data-lucide="home"></i> Main Page</button>
        <button id="closeBtn" class="bg-blue-700 text-white px-5 py-2 rounded-lg hover:bg-blue-800 transition">Close</button>
      </div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    // Update last updated date
    document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'long' 
    });

    // Correct webhook URL
    const WEBHOOK_URL = 'https://aarvisingla1609.app.n8n.cloud/webhook/ai-answer';

    // Categorized questions
    const questionCategories = [
      {
        title: "1. Overview and Key Concepts",
        questions: [
          "What is the primary objective behind the introduction of the new criminal laws in India?",
          "What are the core principles of the new criminal laws?",
          "What prompted the Indian government to introduce the new criminal laws?",
          "How do the new criminal laws address the issue of cybercrime differently from the previous laws?"
        ]
      },
      {
        title: "2. Specific Provisions and Clauses",
        questions: [
          "Which section of the new criminal laws deals with cyberbullying?",
          "How does the new law address sexual harassment in the workplace?",
          "What is the maximum punishment for an individual found guilty of cyberstalking under the new criminal laws?",
          "What is the definition of 'terrorist financing' under the new criminal laws?"
        ]
      },
      {
        title: "3. Implementation and Enforcement",
        questions: [
          "Who is responsible for implementing the provisions of the new criminal laws at the state level?",
          "How do the new criminal laws protect digital evidence during investigations?",
          "What are the challenges in enforcing the new criminal laws?",
          "What role do forensic experts play under the new criminal laws?"
        ]
      },
      {
        title: "4. Impact on Citizens and Society",
        questions: [
          "How do the new criminal laws enhance the protection of women in India?",
          "What impact do the new criminal laws have on marginalized communities?",
          "How do the new criminal laws affect the rights of accused individuals?",
          "What is the potential impact of the new criminal laws on public trust in the judicial system?"
        ]
      },
      {
        title: "5. Judicial Interpretation and Case Studies",
        questions: [
          "Which landmark case helped shape the interpretation of 'terrorist financing' under the new laws?",
          "How have the courts interpreted the new provisions related to cybercrimes?",
          "Which case demonstrates the application of the new provisions related to online defamation?",
          "What significance does the interpretation of 'incitement to violence' have under the new criminal laws?"
        ]
      },
      {
        title: "6. Criticism and Support",
        questions: [
          "What are the main criticisms raised against the new criminal laws?",
          "What are the arguments made by supporters of the new criminal laws?",
          "How do human rights organizations view the new criminal laws?"
        ]
      },
      {
        title: "7. Comparisons with International Law",
        questions: [
          "How do India’s new criminal laws compare to similar laws in the United States?",
          "Which international convention has influenced India’s anti-terrorism laws?",
          "How do India’s new laws address data protection compared to the European Union’s GDPR?"
        ]
      }
    ];

    // Render categorized questions
    const container = document.getElementById('sampleQuestions');
    let questionIndex = 0;

    questionCategories.forEach(category => {
      const header = document.createElement('div');
      header.className = 'font-semibold text-gray-800 mt-3 mb-2 border-b pb-1';
      header.textContent = category.title;
      container.appendChild(header);

      category.questions.forEach(q => {
        const id = `q${questionIndex++}`;
        const div = document.createElement('div');
        div.className = 'flex items-start py-1';
        div.innerHTML = `
          <input type="radio" id="${id}" name="sampleQ" value="${q}" class="mt-1.5 text-blue-600 focus:ring-blue-600">
          <label for="${id}" class="ml-2 text-sm text-gray-700 cursor-pointer hover:text-blue-700">${q}</label>
        `;
        container.appendChild(div);
      });
    });

    // Handle sample question selection
    container.addEventListener('change', e => {
      if (e.target.name === 'sampleQ') {
        document.getElementById('question').value = e.target.value;
      }
    });

    // Modal functions
    const modal = document.getElementById('modal');
    const openModal = () => modal.classList.remove('hidden');
    const closeModal = () => modal.classList.add('hidden');
    document.getElementById('closeBtn').onclick = closeModal;
    document.getElementById('closeModal').onclick = closeModal;
    document.getElementById('mainPageBtn').onclick = () => window.location.href = 'index.html';
    document.getElementById('mainPageModalBtn').onclick = () => window.location.href = 'index.html';

    // Language selection
    let selectedLanguage = 'English';
    document.querySelectorAll('.langBtn').forEach(btn => {
      btn.addEventListener('click', function() {
        selectedLanguage = this.dataset.lang;
        document.querySelectorAll('.langBtn').forEach(b => b.classList.replace('bg-blue-700', 'bg-gray-500'));
        this.classList.replace('bg-gray-500', 'bg-blue-700');
      });
    });

    // Submit handler
    document.getElementById('submitBtn').addEventListener('click', async () => {
      const name = document.getElementById('name').value.trim() || 'Visitor';
      const question = document.getElementById('question').value.trim();
      if (!question) {
        alert('Please enter a question');
        return;
      }

      document.getElementById('submitBtn').disabled = true;
      document.getElementById('status').textContent = 'Getting response...';

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, question, language: selectedLanguage })
        });

        let answerText = '';
        if (res.ok) {
          const data = await res.json();
          answerText = data.answer || data.error || "No answer received.";
        } else {
          answerText = `Error: ${res.status} ${res.statusText}`;
        }

        document.getElementById('userQuestion').textContent = question;
        document.getElementById('aiAnswer').textContent = answerText;
        openModal();
      } catch (err) {
        alert('Connection failed: ' + err.message);
      } finally {
        document.getElementById('submitBtn').disabled = false;
        document.getElementById('status').textContent = '';
      }
    });

    // Voice Input Setup
    let recognition;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('question').value = transcript;
        document.getElementById('status').textContent = '';
        updateVoiceButton('mic', 'Speak');
      };

      recognition.onerror = (event) => {
        console.error('Voice error:', event.error);
        document.getElementById('status').textContent = 'Voice error: ' + event.error;
        updateVoiceButton('mic', 'Speak');
      };

      recognition.onend = () => {
        updateVoiceButton('mic', 'Speak');
      };
    }

    function updateVoiceButton(icon, text) {
      document.getElementById('voiceBtn').innerHTML = `<i data-lucide="${icon}"></i> <span>${text}</span>`;
      lucide.createIcons();
    }

    document.getElementById('voiceBtn').addEventListener('click', () => {
      if (!recognition) {
        alert('Voice input not supported. Try Chrome or Edge.');
        return;
      }

      const langMap = {
        'English': 'en-IN',
        'Hindi': 'hi-IN',
        'Punjabi': 'pa-IN'
      };
      recognition.lang = langMap[selectedLanguage] || 'en-IN';

      updateVoiceButton('mic-off', 'Listening...');
      document.getElementById('status').textContent = 'Listening... Speak now.';

      try {
        recognition.start();
      } catch (err) {
        console.error('Voice start error:', err);
        document.getElementById('status').textContent = 'Voice error: ' + err.message;
        updateVoiceButton('mic', 'Speak');
      }
    });

    // Copy button
    document.getElementById('copyBtn').onclick = () => {
      navigator.clipboard.writeText(document.getElementById('aiAnswer').textContent);
      alert('Copied to clipboard');
    };
  </script>
</body>
</html>
