<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NyayaMitra (‡§®‡•ç‡§Ø‡§æ‡§Ø‡§Æ‡§ø‡§§‡•ç‡§∞) ‚Äì AI-Powered Criminal Law Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: radial-gradient(ellipse at top, #1e3a8a, #0f172a);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(249, 115, 22, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }
    
    .playfair { font-family: 'Playfair Display', serif; }
    .container-main { position: relative; z-index: 1; }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #ff6b35 0%, #f59e0b 50%, #ff6b35 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% auto;
      animation: shimmer 3s linear infinite;
    }
    
    @keyframes shimmer { to { background-position: 200% center; } }
    
    .header-glow { position: relative; }
    .header-glow::before {
      content: '';
      position: absolute;
      top: -20px; left: 50%;
      transform: translateX(-50%);
      width: 200px; height: 200px;
      background: radial-gradient(circle, rgba(251, 191, 36, 0.3), transparent 70%);
      filter: blur(40px);
      pointer-events: none;
    }
    
    .fade-in { animation: fadeIn 0.8s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
      }
      50% { 
        transform: scale(1.02);
        box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
      }
    }
    
    .query-type-selector {
      background: linear-gradient(135deg, #fef3c7, #fed7aa);
      border: 3px solid #f59e0b;
      border-radius: 16px;
      padding: 16px 12px;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
    }
    
    .radio-option {
      position: relative;
      display: flex;
      align-items: flex-start;
      padding: 10px 12px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 10px;
      min-height: 55px;
    }
    
    .radio-option:hover {
      border-color: #f59e0b;
      transform: translateX(3px);
      box-shadow: 0 3px 12px rgba(245, 158, 11, 0.2);
    }
    
    .radio-option.selected {
      border-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
      transform: scale(1.01);
    }
    
    .radio-option input[type="radio"] {
      width: 18px; height: 18px;
      margin-right: 10px;
      cursor: pointer;
      accent-color: #f59e0b;
      flex-shrink: 0;
    }
    
    .radio-icon { font-size: 20px; margin-right: 8px; flex-shrink: 0; }
    .radio-label {
      flex: 1;
    }
    .radio-label-title {
      font-size: 13px;
      font-weight: 700;
      color: #1f2937;
      line-height: 1.2;
    }
    .radio-label-desc {
      font-size: 10px;
      color: #6b7280;
      line-height: 1.3;
      margin-top: 2px;
    }
    
    .user-card {
      padding: 12px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      min-height: 90px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .user-card:hover {
      border-color: #f59e0b;
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
    }
    
    .user-card.selected {
      border-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
      transform: scale(1.03);
    }
    
    .user-icon { font-size: 32px; margin-bottom: 6px; }
    .user-title {
      font-size: 13px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 2px;
      line-height: 1.2;
    }
    .user-desc {
      font-size: 9px;
      color: #6b7280;
      line-height: 1.2;
    }
    
    .user-card-small {
      padding: 10px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      min-height: 85px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .user-card-small:hover {
      border-color: #3b82f6;
      transform: translateY(-3px);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
    }
    
    .user-card-small.selected {
      border-color: #3b82f6;
      background: linear-gradient(135deg, #dbeafe, #bfdbfe);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
      transform: scale(1.02);
    }
    
    .user-icon-small { font-size: 28px; margin-bottom: 4px; }
    .user-title-small {
      font-size: 12px;
      font-weight: 700;
      color: #1f2937;
      line-height: 1.2;
    }
    .user-desc-small {
      font-size: 9px;
      color: #6b7280;
      line-height: 1.2;
      margin-top: 2px;
    }
    
    .topic-card {
      padding: 10px 14px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .topic-card:hover {
      border-color: #3b82f6;
      transform: translateX(4px);
      box-shadow: 0 4px 14px rgba(59, 130, 246, 0.2);
    }
    
    .topic-card.selected {
      border-color: #3b82f6;
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
    }
    
    .topic-icon { font-size: 22px; flex-shrink: 0; }
    .topic-title {
      font-size: 13px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 1px;
      line-height: 1.2;
    }
    .topic-subtitle {
      font-size: 9px;
      color: #6b7280;
      line-height: 1.2;
    }
    .topic-law {
      font-size: 9px;
      color: #3b82f6;
      font-weight: 600;
      margin-top: 1px;
    }
    
    .mic-btn { transition: all 0.3s; }
    .mic-btn.recording {
      background: linear-gradient(135deg, #dc2626, #ef4444) !important;
      animation: pulseRec 1.5s ease-in-out infinite;
    }
    
    @keyframes pulseRec {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #ff6b35, #f59e0b);
      color: white;
      font-weight: 700;
      padding: 18px 32px;
      border-radius: 16px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(255, 107, 53, 0.5);
    }
    
    .ai-try-btn {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      min-width: 100px;
    }
    
    .ai-try-btn:hover {
      border-color: #8b5cf6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
    }
    
    .ai-try-btn.active {
      border-color: #8b5cf6;
      background: linear-gradient(135deg, #faf5ff, #f3e8ff);
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
      transform: scale(1.05);
    }
    
    .ai-try-btn.used {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: #d1d5db;
      background: #f3f4f6;
    }
    
    .ai-try-btn:disabled {
      cursor: not-allowed;
    }
    
    .ai-try-btn-compact {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 70px;
    }
    
    .ai-try-btn-compact:hover {
      border-color: #8b5cf6;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
    }
    
    .ai-try-btn-compact.active {
      border-color: #8b5cf6;
      background: linear-gradient(135deg, #faf5ff, #f3e8ff);
      box-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
    }
    
    .answer-level-btn {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 80px;
    }
    
    .answer-level-btn:hover {
      border-color: #f59e0b;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
    }
    
    .answer-level-btn.active {
      border-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      box-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
      font-weight: 700;
    }
    
    .compact-dropdown {
      padding: 6px 32px 6px 10px;
      border: 2px solid #d1d5db;
      border-radius: 8px;
      background: white;
      font-size: 13px;
      font-weight: 600;
      color: #1f2937;
      cursor: pointer;
      transition: all 0.3s;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      min-width: 130px;
    }
    
    .compact-dropdown:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }
    
    .compact-dropdown:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .icon-btn {
      padding: 8px;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }
    
    .icon-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    @media (max-width: 768px) {
      .header-glow { padding: 12px 16px 8px !important; }
      .header-glow h1 { font-size: 2.5rem !important; }
      .user-card { min-height: 85px; padding: 10px; }
      .user-icon { font-size: 28px; margin-bottom: 4px; }
      .user-title { font-size: 12px; }
      .user-desc { font-size: 8px; }
      .topic-card { padding: 8px 12px; }
      .topic-icon { font-size: 20px; }
      .topic-title { font-size: 12px; }
      .radio-option { min-height: 50px; padding: 8px 10px; }
      .radio-icon { font-size: 18px; }
    }
    
    /* Tablet and larger - optimize topic cards for 2-3 columns */
    @media (min-width: 640px) and (max-width: 1023px) {
      .topic-card { padding: 10px 12px; }
      .topic-title { font-size: 12px; }
      .topic-subtitle { font-size: 9px; }
    }
    
    /* Desktop - optimize for 3 column layout */
    @media (min-width: 1024px) {
      .topic-card { 
        padding: 10px 14px;
        min-height: 70px;
      }
      .user-card {
        min-height: 95px;
      }
    }
    
    /* Large desktop - more comfortable spacing */
    @media (min-width: 1280px) {
      .topic-card { 
        padding: 12px 16px;
        min-height: 75px;
      }
      .user-card {
        min-height: 100px;
        padding: 14px;
      }
      .user-icon { font-size: 36px; }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

  <div class="container-main w-full max-w-5xl glass-card rounded-3xl shadow-2xl overflow-hidden">
    
    <div class="relative bg-gradient-to-br from-orange-50 via-amber-50 to-yellow-50 p-6 pb-4 text-center header-glow">
      <div class="floating">
        <h1 class="text-5xl md:text-6xl font-black gradient-text mb-2 playfair tracking-tight">
          NyayaMitra
        </h1>
        <p class="text-2xl md:text-3xl font-bold text-orange-600 mb-1" style="font-family: 'Noto Sans Devanagari', sans-serif;">
          ‡§®‡•ç‡§Ø‡§æ‡§Ø‡§Æ‡§ø‡§§‡•ç‡§∞
        </p>
      </div>
      <p class="text-sm text-gray-600 font-semibold mb-3 tracking-wide">
        Your AI Assistant for New Criminal Laws
      </p>
      
      <div class="w-full max-w-2xl mx-auto px-4">
        <div class="bg-white rounded-2xl border-3 border-orange-400 py-2 px-4 shadow-xl">
          <h2 class="text-xs sm:text-sm font-black text-center bg-gradient-to-r from-orange-600 to-amber-600 bg-clip-text text-transparent leading-tight">
            Bharatiya Nyaya Sanhita ‚Ä¢ Bharatiya Nagarik Suraksha Sanhita ‚Ä¢ Bharatiya Sakshya Adhiniyam
          </h2>
        </div>
      </div>
    </div>

    <div class="p-2">
      
      <!-- ALWAYS VISIBLE: Who are you? -->
      <div class="mb-4">
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-2xl p-4" id="profileSelector">
          <label class="block text-base font-bold text-gray-800 mb-3 flex items-center gap-2">
            <span class="bg-blue-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold">üë§</span>
            Who are you?
            <span class="text-xs font-normal text-gray-600">(Default: General Citizen - Change if needed)</span>
          </label>
          
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
            <div class="user-card-small" id="userPoliceMain" onclick="selectMainUser('police')">
              <div class="user-icon-small">üëÆ</div>
              <div class="user-title-small">Police Officer</div>
              <div class="user-desc-small">Investigation, FIR, Procedures</div>
            </div>
            
            <div class="user-card-small" id="userLegalMain" onclick="selectMainUser('legal')">
              <div class="user-icon-small">‚öñÔ∏è</div>
              <div class="user-title-small">Legal Professional</div>
              <div class="user-desc-small">Lawyers, Judges, Prosecutors</div>
            </div>
            
            <div class="user-card-small" id="userStudentMain" onclick="selectMainUser('student')">
              <div class="user-icon-small">üë®‚Äçüéì</div>
              <div class="user-title-small">Student/Researcher</div>
              <div class="user-desc-small">Law students, Academics</div>
            </div>
            
            <div class="user-card-small" id="userCitizenMain" onclick="selectMainUser('citizen')">
              <div class="user-icon-small">üßë‚Äçüíº</div>
              <div class="user-title-small">General Citizen</div>
              <div class="user-desc-small">Rights, Complaints, Info</div>
            </div>
          </div>
          
          <p class="text-xs text-blue-700 mt-2 text-center italic font-semibold" id="profileHint">
            ‚úì Default: General Citizen (You can change this above)
          </p>
        </div>
      </div>
      
      <div class="query-type-selector">
        <h3 class="text-xl font-bold text-gray-900 mb-4 text-center flex items-center justify-center gap-2">
          <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          What would you like to know?
        </h3>
        
        <div class="radio-option selected" id="customCard" onclick="selectQueryType('custom')">
          <input type="radio" name="queryType" value="custom" checked onclick="event.stopPropagation(); selectQueryType('custom')">
          <span class="radio-icon">‚úèÔ∏è</span>
          <div class="radio-label">
            <div class="radio-label-title">Ask Your Own Question</div>
            <div class="radio-label-desc">Type any question about criminal laws</div>
          </div>
        </div>
        
        <div class="radio-option" id="readyCard" onclick="selectQueryType('ready')">
          <input type="radio" name="queryType" value="ready" onclick="event.stopPropagation(); selectQueryType('ready')">
          <span class="radio-icon">üìã</span>
          <div class="radio-label">
            <div class="radio-label-title">Select Ready-Made Question</div>
            <div class="radio-label-desc">Choose by your profile and topic</div>
          </div>
        </div>
      </div>

      <div id="questionSection">
        
        <!-- CUSTOM QUESTION DIV -->
        <div id="customQuestionDiv" class="mb-8 fade-in">
          <div class="relative">
            <textarea
              id="userInput"
              rows="3"
              class="w-full rounded-2xl border-4 border-orange-400 p-4 pb-12 text-gray-900 bg-gradient-to-br from-white to-orange-50 shadow-2xl resize-none focus:border-orange-500 focus:ring-4 focus:ring-orange-200 transition-all duration-300"
              placeholder="Type your question here... (e.g., What are my rights during arrest?)"
              oninput="showAutocompleteSuggestions()"
              onfocus="showAutocompleteSuggestions()"
            ></textarea>
            <button
              id="voiceBtn"
              class="mic-btn absolute bottom-3 right-3 text-orange-500 hover:text-orange-700 transition-all bg-white rounded-full p-3 shadow-lg border-2 border-orange-300"
              title="Click to speak"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
              </svg>
            </button>
          </div>
          
          <!-- Autocomplete Suggestions Box -->
          <div id="autocompleteSuggestions" class="hidden mt-2 bg-white border-2 border-orange-300 rounded-xl shadow-lg max-h-60 overflow-y-auto">
            <!-- Suggestions will be added here dynamically -->
          </div>
        </div>

        <!-- READY QUESTIONS DIV -->
        <div id="readyQuestionDiv" style="display: none;" class="mb-8 fade-in">
          
          <!-- Step 1: WHAT TOPIC? (Profile already selected at top) -->
          <div class="mb-6" id="topicSection" style="display: none;">
            <label class="block text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
              <span class="bg-orange-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold">1</span>
              üìö What do you want to know about?
            </label>
            <p class="text-xs text-gray-600 mb-4 ml-10">Choose a topic - we'll find the right law for you</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2" id="topicContainer">
              <!-- Topics will load here dynamically -->
            </div>
          </div>
          
          <!-- Step 2: SELECT YOUR QUESTION -->
          <div class="mb-6" id="questionSelectSection" style="display: none;">
            <label class="block text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
              <span class="bg-orange-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold">2</span>
              ‚ùì Select Your Question
            </label>
            
            <select id="questionSelect" class="block w-full px-5 py-4 text-base border-3 border-orange-400 focus:ring-4 focus:ring-orange-200 rounded-2xl bg-gradient-to-br from-white to-orange-50 shadow-lg transition-all font-medium mb-4">
              <option value="" selected disabled>Select a question...</option>
            </select>
          </div>
          
        </div>

        <!-- Language Selection - Before Submit Button -->
        <div class="mb-4 fade-in">
          <div class="flex items-center justify-between bg-gradient-to-r from-orange-50 to-yellow-50 p-3 rounded-xl border-2 border-orange-200">
            <label class="text-sm font-bold text-gray-800 flex items-center gap-2">
              <span class="text-xl">üåê</span>
              Response Language:
            </label>
            <select id="languageSelect" 
                    class="px-4 py-2 border-2 border-orange-400 rounded-lg bg-white text-sm font-bold text-gray-800 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition cursor-pointer hover:bg-orange-50">
              <option value="english">üá¨üáß English</option>
              <option value="hindi">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
              <option value="punjabi">üáÆüá≥ ‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
            </select>
          </div>
        </div>

        <button 
          id="submitBtn" 
          class="w-full btn-primary flex items-center justify-center gap-3 text-xl fade-in"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          Get Answer
        </button>

      </div>

    </div>

    <div class="border-t-2 border-gray-200 px-6 py-4 text-center bg-gradient-to-b from-gray-50 to-white">
      <p class="text-sm text-gray-700 mb-2 font-medium">
        AI Chatbot powered by <span class="font-bold text-orange-600">Groq + Llama 3.3</span>
      </p>
      <p class="text-gray-500 text-xs mb-3">
        Designed by <strong>NIC, Kurukshetra</strong> for <strong>District Administration, Kurukshetra</strong>
      </p>
      <p class="text-xs text-gray-600 font-semibold">
        Last Modified: <span id="lastModified" class="text-orange-700 font-bold">Loading...</span>
      </p>
    </div>

  </div>

  <!-- FIXED MODAL WITH PROPER HEIGHT MANAGEMENT -->
  <div id="aiModal" class="hidden fixed inset-0 flex items-center justify-center p-2" style="z-index: 9999; background: rgba(0,0,0,0.92);">
    <div class="bg-white rounded-3xl shadow-2xl w-full mx-2 flex flex-col" style="max-width: 850px; max-height: 90vh;">
      
      <!-- Header - Fixed -->
      <div class="flex justify-between items-center px-5 py-4 bg-gradient-to-r from-blue-600 to-indigo-700 text-white flex-shrink-0">
        <h2 class="text-xl font-bold flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
          NyayaMitra Response
        </h2>
        <button id="closeModal" class="hover:bg-white/20 p-2 rounded-full transition">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Scrollable Content Area -->
      <div class="p-5 overflow-y-auto bg-gray-50 flex-1" style="min-height: 0;">
        <div class="mb-5">
          <p class="font-bold text-gray-900 mb-2">Question:</p>
          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-2xl border-l-4 border-blue-500">
            <pre id="modalQuestion" class="whitespace-pre-wrap text-gray-800"></pre>
          </div>
        </div>

        <div>
          <p class="font-bold text-gray-900 mb-2">Answer:</p>
          <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-4 rounded-2xl border-l-4 border-orange-500">
            <pre id="modalAnswer" class="whitespace-pre-wrap text-gray-800 text-sm leading-loose"></pre>
          </div>
        </div>
      </div>

      <!-- Ultra-Compact Footer - Single Row with Dropdowns -->
      <div class="border-t-2 border-gray-200 bg-white flex-shrink-0">
        <div class="px-4 py-3 flex items-center justify-between gap-3 flex-wrap">
          
          <!-- Left side: Dropdowns -->
          <div class="flex items-center gap-3 flex-wrap">
            <!-- Answer Depth Dropdown -->
            <div class="flex items-center gap-2">
              <label class="text-xs font-bold text-gray-700 whitespace-nowrap">üìä Depth:</label>
              <select id="depthSelector" class="compact-dropdown" onchange="changeAnswerLevel(this.value)">
                <option value="brief">üìù Brief</option>
                <option value="standard" selected>üìÑ Standard</option>
                <option value="detailed">üìö Detailed</option>
              </select>
            </div>
            
            <!-- AI Engine Dropdown -->
            <div class="flex items-center gap-2">
              <label class="text-xs font-bold text-gray-700 whitespace-nowrap">ü§ñ AI:</label>
              <select id="aiSelector" class="compact-dropdown" onchange="retryWithAI(this.value)">
                <option value="groq" selected>üöÄ Groq Llama</option>
                <option value="chatgpt">ü§ñ ChatGPT</option>
              </select>
            </div>
          </div>
          
          <!-- Right side: Action Buttons -->
          <div class="flex items-center gap-2">
            <button onclick="shareOnWhatsApp()" class="icon-btn bg-green-600 hover:bg-green-700" title="Share on WhatsApp">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
            </button>
            
            <button onclick="openSectionSearch()" class="icon-btn bg-blue-600 hover:bg-blue-700" title="Search Related Sections (Opens with keywords from your question)">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </button>
            
            <button id="closeBtn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition font-semibold text-sm">
              Close
            </button>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <script>
    console.log('üöÄ NyayaMitra initializing...');
    
    // Update Last Modified DateTime - AUTOMATIC FROM FILE
    function updateLastModified() {
      try {
        let lastModDate;
        
        // Get document's last modified date
        if (document.lastModified) {
          lastModDate = new Date(document.lastModified);
          console.log('üìÖ Document last modified (raw):', document.lastModified);
        }
        
        // Validate date
        if (!lastModDate || isNaN(lastModDate.getTime())) {
          lastModDate = new Date();
          console.log('‚ö†Ô∏è Using current date as fallback');
        }
        
        const day = lastModDate.getDate();
        const suffix = (day) => {
          if (day > 3 && day < 21) return 'th';
          switch (day % 10) {
            case 1: return 'st';
            case 2: return 'nd';
            case 3: return 'rd';
            default: return 'th';
          }
        };
        
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        const month = monthNames[lastModDate.getMonth()];
        const year = lastModDate.getFullYear();
        const hours = lastModDate.getHours().toString().padStart(2, '0');
        const minutes = lastModDate.getMinutes().toString().padStart(2, '0');
        
        const formattedDate = `${day}${suffix(day)} ${month} ${year}, ${hours}:${minutes} IST`;
        
        const element = document.getElementById('lastModified');
        if (element) {
          element.textContent = formattedDate;
          console.log('‚úÖ Last Modified displayed:', formattedDate);
        }
      } catch (error) {
        console.error('‚ùå Last Modified error:', error);
        const element = document.getElementById('lastModified');
        if (element) {
          element.textContent = '17th December 2025, 23:30 IST';
        }
      }
    }
    
    // Call when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', updateLastModified);
    } else {
      updateLastModified();
    }
    
    // Set default profile on page load
    function setDefaultProfile() {
      // Default to General Citizen (most common user type)
      selectMainUser('citizen');
      console.log('‚úÖ Default profile set: General Citizen');
    }
    
    // Initialize default profile when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setDefaultProfile);
    } else {
      setDefaultProfile();
    }
    
    const WEBHOOK_URL = 'https://n8n-workflow-test.duckdns.org/webhook/chatbot';
    
    // VERSION CHECK - This will appear in console immediately
    console.log('üî• NyayaMitra Version: ARRAY-FIX-v2 - Loaded at', new Date().toISOString());
    console.log('üî• If you see this, the new version is loaded!');
    
    let currentQuestion = '';
    let currentAI = 'groq';
    let selectedUser = 'citizen'; // Default to General Citizen
    let selectedTopic = '';
    let selectedQueryType = 'custom';
    let aiUsed = {
      groq: false,
      chatgpt: false
    };
    
    // User-level specific prompt instructions with ENHANCED FORMATTING
    const USER_LEVEL_PROMPTS = {
      police: {
        level: 'intermediate',
        instruction: 'You are answering for a Police Officer. Provide practical, action-oriented answers with clear procedures, legal provisions, and step-by-step guidance. Focus on investigation procedures, FIR handling, arrest protocols, and evidence collection. Use official terminology but keep it practical for field work.',
        tone: 'Professional and procedural'
      },
      legal: {
        level: 'advanced',
        instruction: 'You are answering for a Legal Professional (Lawyer/Judge/Prosecutor). Provide detailed legal analysis with specific section references, case law interpretations, procedural nuances, and technical legal terminology. Include comparative analysis between old and new laws where relevant.',
        tone: 'Technical and analytical'
      },
      student: {
        level: 'educational',
        instruction: 'You are answering for a Law Student/Researcher. Provide comprehensive educational content with clear explanations, examples, conceptual clarity, and academic perspective. Include both theoretical understanding and practical applications. Use structured format with key points.',
        tone: 'Educational and detailed'
      },
      citizen: {
        level: 'basic',
        instruction: 'You are answering for a General Citizen. Provide simple, easy-to-understand explanations in plain language. Focus on practical rights, what to do in common situations, and step-by-step guidance. Avoid complex legal jargon. Use examples and analogies.',
        tone: 'Simple and practical'
      }
    };
    
    // Multi-level answer depth options (sent to n8n as metadata)
    const ANSWER_LEVELS = {
      brief: {
        label: 'üìù Brief',
        instruction: 'Provide a concise answer in 2-3 paragraphs covering only the essential points.',
        icon: 'üìù'
      },
      standard: {
        label: 'üìÑ Standard',
        instruction: 'Provide a comprehensive answer with all important details, examples, and relevant sections.',
        icon: 'üìÑ'
      },
      detailed: {
        label: 'üìö Detailed',
        instruction: 'Provide an in-depth, exhaustive answer covering all aspects, subsections, exceptions, examples, and practical implications.',
        icon: 'üìö'
      }
    };
    
    let currentAnswerLevel = 'standard'; // Default level
    
    // Main answer function - send CLEAN data to n8n
    async function getAnswer(provider, answerLevel = 'standard') {
      currentAI = provider;
      currentAnswerLevel = answerLevel;
      aiUsed[provider] = true;
      
      const loadingMessages = {
        groq: '‚ö° Groq is processing at lightning speed...',
        chatgpt: 'ü§ñ ChatGPT is analyzing deeply...'
      };
      
      const providerNames = {
        groq: 'üöÄ Groq Llama 3.3',
        chatgpt: 'ü§ñ ChatGPT GPT-4o'
      };
      
      document.getElementById('modalQuestion').textContent = currentQuestion;
      document.getElementById('modalAnswer').innerHTML = loadingMessages[provider];
      document.getElementById('aiModal').classList.remove('hidden');
      
      updateModalHeader(provider);
      updateAIButtons();
      updateAnswerLevelButtons();
      
      const startTime = Date.now();
      
      try {
        // Get selected language
        const selectedLanguage = document.getElementById('languageSelect').value;
        console.log('üåê Selected language:', selectedLanguage);
        
        // Send CLEAN data - let n8n handle formatting
        const response = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            question: currentQuestion, // CLEAN question only
            originalQuestion: currentQuestion,
            provider: provider,
            userType: selectedUser,
            userLevel: selectedUser ? USER_LEVEL_PROMPTS[selectedUser].level : 'general',
            topic: selectedTopic,
            queryType: selectedQueryType,
            answerDepth: answerLevel,
            language: selectedLanguage,  // ‚Üê LANGUAGE PARAMETER ADDED
            timestamp: new Date().toISOString()
          })
        });
        
        if (!response.ok) throw new Error('HTTP ' + response.status);
        
        let data = await response.json();
        console.log('üì• RAW Received data:', JSON.stringify(data).substring(0, 200));
        console.log('üì• Is Array?', Array.isArray(data));
        console.log('üì• Type:', typeof data);
        
        // n8n returns an array, get first item
        if (Array.isArray(data) && data.length > 0) {
          console.log('üì¶ Extracting from array, length:', data.length);
          data = data[0];
          console.log('üì¶ Extracted object:', data);
        }
        
        // Handle different response formats
        let answerText = '';
        if (typeof data === 'string') {
          console.log('‚úÖ Format: Direct string');
          answerText = data;
        } else if (data && data.answer) {
          console.log('‚úÖ Format: Object with answer property');
          console.log('‚úÖ Answer length:', data.answer.length);
          answerText = data.answer;
        } else if (data && data.response) {
          console.log('‚úÖ Format: Object with response property');
          answerText = data.response;
        } else if (data && data.choices && data.choices[0] && data.choices[0].message) {
          console.log('‚úÖ Format: Groq API format');
          answerText = data.choices[0].message.content;
        } else {
          console.error('‚ùå Could not find answer in data');
          console.error('‚ùå Data keys:', data ? Object.keys(data) : 'null');
          console.error('‚ùå Full data:', data);
          answerText = 'No answer generated (empty model output).';
        }
        
        // Clean up any remaining issues
        answerText = answerText.replace('[SEARCH_BUTTON]', '');
        answerText = answerText.replace(/üîç SEARCH KEYWORDS:.*?\n\n/gs, '');
        
        // Convert markdown links to HTML
        function convertMarkdownLinksToHTML(text) {
          // Convert [Text](URL) to <a href="URL" target="_blank">Text</a>
          return text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color: #3b82f6; text-decoration: underline;">$1</a>');
        }
        
        // Convert newlines to <br> and links to HTML
        answerText = answerText
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/\n/g, '<br>');
        
        // Now convert markdown links (after escaping HTML)
        answerText = convertMarkdownLinksToHTML(answerText);
        
        // ============================================
        // EXTRACT AND REMOVE RELATED QUESTIONS
        // ============================================
        let relatedQuestions = [];
        
        console.log('üîç Searching for related questions in answer...');
        
        // Try to find related questions section
        const relatedPattern = /‚ùì\s*RELATED QUESTIONS[\s\S]*?(?=‚ö†Ô∏è|‚îÅ‚îÅ‚îÅ|$)/i;
        const relatedMatch = answerText.match(relatedPattern);
        
        if (relatedMatch) {
          console.log('‚úÖ Found related questions section');
          const relatedSection = relatedMatch[0];
          
          // Split by <br> and extract questions
          const lines = relatedSection.split(/<br\s*\/?>/gi);
          
          for (let line of lines) {
            // Clean HTML entities
            let cleaned = line
              .replace(/&lt;/g, '<')
              .replace(/&gt;/g, '>')
              .replace(/&amp;/g, '&')
              .replace(/&quot;/g, '"')
              .trim();
            
            // Skip header line and empty lines
            if (cleaned.length < 10 || cleaned.match(/RELATED QUESTIONS/i)) {
              continue;
            }
            
            // Remove bullet points, numbers, dashes
            cleaned = cleaned.replace(/^[\s‚Ä¢\-\d\.\)]+/, '').trim();
            
            // Must have question mark and be reasonable length
            if (cleaned.includes('?') && cleaned.length > 15 && cleaned.length < 300) {
              relatedQuestions.push(cleaned);
              console.log('  üìå Extracted:', cleaned.substring(0, 60) + '...');
            }
          }
          
          // Limit to 3 questions
          relatedQuestions = relatedQuestions.slice(0, 3);
          console.log('‚úÖ Total questions extracted:', relatedQuestions.length);
          
          // REMOVE the entire related questions section from answer
          answerText = answerText.replace(relatedPattern, '');
          console.log('‚úÖ Related questions section removed from answer body');
        } else {
          console.log('‚ö†Ô∏è No related questions section found');
        }
        
        const responseTime = ((Date.now() - startTime) / 1000).toFixed(2);
        
        // Add metadata footer
        const levelEmoji = ANSWER_LEVELS[answerLevel].icon;
        const userTypeLabel = selectedUser ? ` | üë§ ${selectedUser.charAt(0).toUpperCase() + selectedUser.slice(1)}` : '';
        
        let finalHTML = answerText + 
          '<br><br>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br>' +
          `${levelEmoji} ${answerLevel.charAt(0).toUpperCase() + answerLevel.slice(1)} Answer${userTypeLabel}<br>` +
          `‚è±Ô∏è Response: ${responseTime}s with ${providerNames[provider]}`;
        
        // ============================================
        // DISPLAY RELATED QUESTIONS DROPDOWN
        // ============================================
        if (relatedQuestions.length > 0) {
          console.log('‚úÖ Adding related questions dropdown');
          
          finalHTML += '<br><br>' +
            '<details open style="background: linear-gradient(to right, #fff7ed, #fef3c7); padding: 14px; border-radius: 12px; border: 2px solid #fb923c; box-shadow: 0 2px 8px rgba(251, 146, 60, 0.2);">' +
              '<summary style="cursor: pointer; font-weight: bold; color: #1f2937; display: flex; align-items: center; gap: 8px; list-style: none; user-select: none;">' +
                '<span style="font-size: 20px;">‚ùì</span> ' +
                '<span style="font-size: 16px;">Related Questions (' + relatedQuestions.length + ')</span> ' +
                '<span style="font-size: 12px; color: #6b7280; margin-left: auto; font-weight: normal;">(Click to ask automatically)</span>' +
              '</summary>' +
              '<div style="margin-top: 12px; display: flex; flex-direction: column; gap: 8px;">';
          
          relatedQuestions.forEach((q, idx) => {
            // Escape quotes properly
            const escapedQuestion = q
              .replace(/\\/g, '\\\\')
              .replace(/'/g, "\\'")
              .replace(/"/g, '&quot;')
              .replace(/\n/g, ' ');
            
            finalHTML += 
              '<div style="background: white; padding: 14px; border-radius: 10px; border-left: 4px solid #fb923c; cursor: pointer; transition: all 0.3s; box-shadow: 0 1px 3px rgba(0,0,0,0.1);" ' +
                   'onmouseover="this.style.background=\'#fff7ed\'; this.style.borderLeftColor=\'#f97316\'; this.style.boxShadow=\'0 4px 12px rgba(251,146,60,0.3)\'; this.style.transform=\'translateX(4px)\';" ' +
                   'onmouseout="this.style.background=\'white\'; this.style.borderLeftColor=\'#fb923c\'; this.style.boxShadow=\'0 1px 3px rgba(0,0,0,0.1)\'; this.style.transform=\'translateX(0)\';" ' +
                   'onclick="askRelatedQuestion(\'' + escapedQuestion + '\')">' +
                '<div style="display: flex; align-items: start; gap: 12px;">' +
                  '<span style="color: #f97316; font-weight: bold; font-size: 16px; min-width: 26px; margin-top: 2px;">' + (idx + 1) + '.</span>' +
                  '<span style="color: #374151; font-size: 15px; line-height: 1.6;">' + q + '</span>' +
                '</div>' +
              '</div>';
          });
          
          finalHTML += '</div></details>';
        }
        
        document.getElementById('modalAnswer').innerHTML = finalHTML;
        
        console.log('‚úÖ Response from', provider, 'in', responseTime, 'seconds');
        
      } catch (error) {
        console.error('‚ùå Error:', error);
        document.getElementById('modalAnswer').innerHTML = 'Error: Could not connect to ' + provider.toUpperCase() + '. Please try again.';
      }
    }
    
    // Retry with different AI
    function retryWithAI(provider) {
      // Allow switching to any AI at any time
      aiUsed[provider] = true;
      getAnswer(provider, currentAnswerLevel);
    }
    
    window.retryWithAI = retryWithAI;
    
    // Change answer depth level
    function changeAnswerLevel(level) {
      currentAnswerLevel = level;
      
      // Update dropdown selection
      const depthSelector = document.getElementById('depthSelector');
      if (depthSelector) {
        depthSelector.value = level;
      }
      
      getAnswer(currentAI, level);
    }
    
    window.changeAnswerLevel = changeAnswerLevel;
    
    // Update answer level buttons (deprecated - now using dropdown)
    function updateAnswerLevelButtons() {
      const depthSelector = document.getElementById('depthSelector');
      if (depthSelector) {
        depthSelector.value = currentAnswerLevel;
      }
    }
    
    // Update AI button states (now updates dropdown)
    function updateAIButtons() {
      const aiSelector = document.getElementById('aiSelector');
      if (aiSelector) {
        aiSelector.value = currentAI;
      }
    }
    
    // Update Modal Header with AI Provider
    function updateModalHeader(provider) {
      const icons = {
        groq: 'üöÄ',
        chatgpt: 'ü§ñ'
      };
      
      const names = {
        groq: 'Groq Llama 3.3',
        chatgpt: 'ChatGPT GPT-4o'
      };
      
      const header = document.querySelector('#aiModal .bg-gradient-to-r h2');
      if (header) {
        header.innerHTML = '<svg class="w-6 h-6 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>' +
          '</svg>' +
          '<span class="ml-2">' + icons[provider] + ' ' + names[provider] + ' Response</span>';
      }
    }
    
    // TOPICS organized by user type
    const TOPICS = {
      police: [
        { id: 'fir', icon: 'üìù', title: 'FIR & Complaints', subtitle: 'Registration, Zero FIR, Refusal', law: 'BNSS' },
        { id: 'arrest', icon: 'üöî', title: 'Arrest & Custody', subtitle: 'Warrant, Remand, Rights', law: 'BNSS' },
        { id: 'investigation', icon: 'üîç', title: 'Investigation', subtitle: 'Evidence, Search, Seizure', law: 'BNSS' },
        { id: 'evidence', icon: 'üìä', title: 'Evidence Handling', subtitle: 'Digital, Chain of custody', law: 'BSA' },
        { id: 'chargesheet', icon: 'üìã', title: 'Charge Sheet', subtitle: 'Filing, Timeline', law: 'BNSS' },
        { id: 'crimes', icon: '‚ö†Ô∏è', title: 'Common Crimes', subtitle: 'Theft, Assault, Cyber', law: 'BNS' },
        { id: 'rights', icon: 'üë•', title: 'Rights of Accused', subtitle: 'During arrest, trial', law: 'BNSS' },
        { id: 'terminology', icon: 'üìö', title: 'Legal Terms', subtitle: 'Cognizable, Bailable', law: 'All' }
      ],
      legal: [
        { id: 'bail', icon: 'üèõÔ∏è', title: 'Bail & Bonds', subtitle: 'Regular, Anticipatory', law: 'BNSS' },
        { id: 'trial', icon: '‚öñÔ∏è', title: 'Trial Process', subtitle: 'Summons, Warrant, Sessions', law: 'BNSS' },
        { id: 'evidence', icon: 'üìä', title: 'Evidence Law', subtitle: 'Admissibility, Electronic', law: 'BSA' },
        { id: 'appeals', icon: 'üìë', title: 'Appeals & Revision', subtitle: 'High Court, Supreme Court', law: 'BNSS' },
        { id: 'punishments', icon: '‚öñÔ∏è', title: 'Punishments', subtitle: 'IPC vs BNS changes', law: 'BNS' },
        { id: 'procedures', icon: 'üìã', title: 'Court Procedures', subtitle: 'Filing, Documentation', law: 'BNSS' },
        { id: 'comparison', icon: 'üîÑ', title: 'Old vs New Laws', subtitle: 'Key changes', law: 'All' },
        { id: 'terminology', icon: 'üìö', title: 'Legal Terminology', subtitle: 'Advanced concepts', law: 'All' }
      ],
      student: [
        { id: 'comparison', icon: 'üîÑ', title: 'Old vs New Laws', subtitle: 'IPC‚ÜíBNS, CrPC‚ÜíBNSS', law: 'All' },
        { id: 'terminology', icon: 'üìö', title: 'Legal Terminology', subtitle: 'All important terms', law: 'All' },
        { id: 'concepts', icon: 'üí°', title: 'Key Concepts', subtitle: 'Mens rea, Actus reus', law: 'BNS' },
        { id: 'criminal', icon: '‚ö†Ô∏è', title: 'Criminal Offences', subtitle: 'Classification, Types', law: 'BNS' },
        { id: 'procedure', icon: 'üìã', title: 'Criminal Procedure', subtitle: 'FIR to Judgment', law: 'BNSS' },
        { id: 'evidence_law', icon: 'üìä', title: 'Evidence Law', subtitle: 'Types, Admissibility', law: 'BSA' },
        { id: 'amendments', icon: 'üìù', title: 'Key Amendments', subtitle: 'Major changes 2024', law: 'All' },
        { id: 'casestudies', icon: 'üìñ', title: 'Examples', subtitle: 'Real-world scenarios', law: 'All' }
      ],
      citizen: [
        { id: 'rights', icon: 'üë•', title: 'Your Rights', subtitle: 'Arrest, trial, investigation', law: 'BNSS' },
        { id: 'complaint', icon: 'üìù', title: 'How to Complain', subtitle: 'FIR, Online complaint', law: 'BNSS' },
        { id: 'bail', icon: 'üèõÔ∏è', title: 'Bail & Release', subtitle: 'How to get bail', law: 'BNSS' },
        { id: 'common', icon: '‚ùì', title: 'Common Situations', subtitle: 'Theft, Accident, Dispute', law: 'BNS' },
        { id: 'legal_aid', icon: '‚öñÔ∏è', title: 'Legal Help', subtitle: 'Free legal aid', law: 'All' },
        { id: 'cybercrime', icon: 'üíª', title: 'Cyber Crimes', subtitle: 'Fraud, Harassment', law: 'BNS' },
        { id: 'women', icon: 'üë©', title: 'Women & Children', subtitle: 'Protection laws', law: 'BNS' },
        { id: 'basics', icon: 'üìö', title: 'Basic Terms', subtitle: 'Simple explanations', law: 'All' }
      ]
    };
    
    // Sample questions for each topic
 // FINAL COMPREHENSIVE TOPIC QUESTIONS - MERGED BEST FROM BOTH LISTS
// 660+ High-Quality Questions - No Duplicates
const TOPIC_QUESTIONS = {
  // ========== POLICE OFFICER QUESTIONS ==========
  
  fir: [
    'How to register an FIR under new criminal laws?',
    'What is Zero FIR and when to use it?',
    'When is Zero FIR mandatory?',
    'When can police refuse to register FIR?',
    'What reasons are valid for refusing FIR?',
    'What information must be included in FIR?',
    'How to handle FIR for cognizable offences?',
    'What is the difference between FIR and complaint?',
    'Online FIR filing process and requirements?',
    'Can FIR be registered at any police station?',
    'What if complainant is unconscious or injured?',
    'How to register FIR for cybercrime?',
    'How to record FIR for online offences?',
    'FIR registration time limits?',
    'FIR registration timeline under BNSS?',
    'Can FIR be corrected after registration?',
    'What is NCR (Non-Cognizable Report)?',
    'How to handle multiple complainants?',
    'FIR for missing person procedure?',
    'Anonymous complaint handling guidelines?',
    'What if FIR involves multiple jurisdictions?',
    'Can FIR be transferred to another PS?',
    'How to register FIR for economic offences?',
    'FIR for offences against women - special procedures?',
    'Cross-FIR in same incident - how to handle?',
    'E-FIR vs regular FIR differences?',
    'What documents to attach with FIR?',
    'FIR in languages other than English/Hindi?',
    'Can witness register FIR on behalf of victim?',
    'How to handle delayed FIR registration?'
  ],
  
  arrest: [
    'When can police arrest without warrant under BNSS?',
    'What are the mandatory procedures during arrest?',
    'When is notice of appearance sufficient?',
    'Rights that must be informed to arrested person?',
    'Medical examination requirements during arrest?',
    'Medical examination timeline after arrest?',
    'Arrest procedures for women - specific rules?',
    'What is police custody vs judicial custody?',
    'Difference between police and judicial custody?',
    'Maximum duration of police remand?',
    'When to arrest juvenile vs adult?',
    'Can arrest be made at night? Restrictions?',
    'How to conduct arrest with dignity?',
    'When to handcuff arrested person?',
    'Arrest memo requirements and format?',
    'Arrest memo preparation checklist?',
    'What if arrested person needs medical attention?',
    'Family notification requirements after arrest?',
    'Strip search rules and limitations?',
    'Arrest of government employees - special procedure?',
    'When can bail be granted during custody?',
    'Custody diary maintenance requirements?',
    'Transfer from police to judicial custody process?',
    'What if arrested person attempts suicide in custody?',
    'Rights of arrested person to meet lawyer?',
    'Arrest in non-bailable vs bailable offences?',
    'Can pregnant woman be arrested?',
    'Preventive detention vs punitive detention?',
    'Release procedures from police custody?'
  ],
  
  investigation: [
    'What are police investigation powers under BNSS?',
    'How to conduct search under Section 93?',
    'Search warrant requirements and validity?',
    'When can search be done without warrant?',
    'Seizure of property - legal procedures?',
    'Chain of custody for evidence - importance?',
    'How to collect digital evidence properly?',
    'Digital evidence seizure procedure?',
    'Investigation timeline under new laws?',
    'Maximum time for investigation in cognizable case?',
    'Can investigation continue after charge sheet?',
    'Rights of accused during investigation?',
    'Witness examination during investigation?',
    'How to record dying declaration?',
    'Confession recording - legal requirements?',
    'Investigation diary (Case Diary) maintenance?',
    'Scene of crime examination procedures?',
    'How to preserve electronic evidence?',
    'How to preserve CCTV footage?',
    'Investigation of cybercrime - special procedures?',
    'Concurrent investigation by multiple agencies?',
    'Investigation in economic offences?',
    'Narco test and polygraph - legal validity?',
    'Voice identification parade procedures?',
    'Investigation closure report (Final Report)?',
    'Further investigation after charge sheet?',
    'Victim role in investigation?',
    'Investigation supervision and monitoring?',
    'Can IO seize mobile without warrant?',
    'Can accused be called repeatedly?'
  ],
  
  evidence: [
    'How to collect digital evidence for court?',
    'Evidence preservation rules under BSA?',
    'Chain of custody requirements and documentation?',
    'Electronic evidence admissibility criteria?',
    'Evidence tampering - legal consequences?',
    'DNA evidence collection procedures?',
    'CCTV footage as evidence - authentication?',
    'Mobile phone evidence extraction?',
    'Email and social media evidence collection?',
    'Audio and video recording evidence?',
    'How to seize computer and electronic devices?',
    'Evidence storage and security protocols?',
    'Expert evidence and forensic reports?',
    'Dying declaration as evidence - requirements?',
    'Tip-off information vs admissible evidence?',
    'Circumstantial evidence vs direct evidence?',
    'Recovery memo preparation?',
    'Evidence contradicting FIR - how to handle?',
    'Lost or destroyed evidence - consequences?',
    'Evidence from private CCTV vs public camera?'
  ],
  
  chargesheet: [
    'How to file charge sheet under BNSS?',
    'Timeline for filing charge sheet?',
    'What happens if charge sheet is delayed?',
    'What documents must be attached with charge sheet?',
    'Documents mandatory with charge sheet?',
    'Charge sheet vs FIR - key differences?',
    'Can charge sheet be challenged in court?',
    'Supplementary charge sheet when needed?',
    'Can supplementary charge sheet be filed?',
    'Charge sheet format and mandatory sections?',
    'Multiple accused in single charge sheet?',
    'How to add new accused after charge sheet?',
    'Victim impact statement in charge sheet?',
    'Evidence list requirements in charge sheet?',
    'Investigation officer signature requirements?',
    'Sanction for prosecution - when required?',
    'Charge sheet in cases of juveniles?',
    'Final report vs charge sheet difference?',
    'Closure report (A-summary) procedure?',
    'Further investigation after charge sheet filed?',
    'Charge sheet in economic offences - special rules?',
    'Time limit extension for charge sheet?',
    'Extension of investigation time ‚Äì procedure?',
    'Defective charge sheet - court powers?',
    'Who approves final report?'
  ],
  
  crimes: [
    'What constitutes theft under BNS Section 303?',
    'How is assault defined in new criminal laws?',
    'Cybercrime reporting and investigation process?',
    'Difference between theft and robbery?',
    'Fraud vs cheating - legal definitions?',
    'Dowry death investigation procedures?',
    'Rape investigation - special procedures?',
    'Murder vs culpable homicide - distinction?',
    'Kidnapping vs abduction differences?',
    'Eve teasing and sexual harassment laws?',
    'Domestic violence - police powers?',
    'Child abuse reporting and investigation?',
    'Senior citizen abuse laws?',
    'Defamation - criminal vs civil?',
    'Criminal intimidation and threats?',
    'Rioting and unlawful assembly?',
    'Forgery and document fraud?',
    'Bribery and corruption offences?',
    'Drug offences investigation?',
    'Arms Act violations?',
    'Motor vehicle accidents - criminal liability?',
    'Outraging modesty of women?',
    'Stalking - new provisions under BNS?',
    'Acid attack - legal provisions?',
    'Human trafficking investigation?'
  ],
  
  rights: [
    'What are rights of arrested person?',
    'Can accused refuse to give statement?',
    'Right to lawyer - when does it begin?',
    'Rights during police interrogation?',
    'What if rights are violated - remedies?',
    'Right to bail under new laws?',
    'Right to medical examination?',
    'Family notification rights?',
    'Right against self-incrimination?',
    'Right to interpreter if language barrier?',
    'Right to food and basic amenities in custody?',
    'Right to meet legal counsel - frequency?',
    'Right to remain silent during investigation?',
    'Rights of women accused - special provisions?',
    'Rights of juvenile in conflict with law?',
    'Right to speedy trial?',
    'Right to cross-examine witnesses?',
    'Right to appeal against arrest?',
    'Right to compensation if wrongfully arrested?',
    'Fundamental rights during criminal proceedings?'
  ],
  
  terminology: [
    'What is cognizable offence?',
    'Define bailable offence vs non-bailable?',
    'What is compounding of offences?',
    'Explain warrant case vs summons case?',
    'What is remand - police vs judicial?',
    'Define anticipatory bail?',
    'What is concurrent sentence vs consecutive sentence?',
    'Explain plea bargaining provisions?',
    'What is probation of offenders?',
    'Define community service as punishment?',
    'What is discharge vs acquittal?',
    'Explain compoundable vs non-compoundable offence?',
    'What is conviction and sentencing?',
    'Define abetment and conspiracy?',
    'What is vicarious liability?',
    'Explain strict liability in criminal law?',
    'What is burden of proof?',
    'Define reasonable doubt?',
    'What is res gestae?',
    'Explain doctrine of alibi?'
  ],
  
  // ========== LEGAL PROFESSIONAL QUESTIONS ==========
  
  bail: [
    'How to apply for regular bail under BNSS Section 479?',
    'Regular bail vs anticipatory bail - key differences?',
    'What factors does court consider for bail?',
    'Grounds for bail rejection under BNSS?',
    'Bail amount calculation and guidelines?',
    'When can bail be cancelled by court?',
    'Bail in non-bailable offences - conditions?',
    'Anticipatory bail procedure and time limits?',
    'Can anticipatory bail be time-bound?',
    'Can bail be granted during investigation?',
    'Bail rejection - appeal process?',
    'Default bail (Section 167 BNSS) provisions?',
    'Difference between default bail and regular bail?',
    'Bail conditions that can be imposed?',
    'Bail conditions enforceability?',
    'Surety requirements for bail?',
    'Cash bail vs personal bond?',
    'Bail in cases involving women accused?',
    'Bail for juveniles - special provisions?',
    'Transit remand vs production warrant?',
    'Bail cancellation grounds?',
    'Modification of bail conditions?',
    'Bail in economic offences - restrictions?',
    'Anticipatory bail duration and extension?',
    'Concurrent jurisdiction for bail?',
    'Bail pending investigation vs pending trial?',
    'Supreme Court guidelines on bail?',
    'Bail in terrorism and UAPA cases?',
    'Personal liberty vs public interest in bail?',
    'Can court impose digital monitoring?'
  ],
  
  trial: [
    'Summons case vs warrant case - differences?',
    'Sessions trial procedure under BNSS?',
    'How long does criminal trial typically take?',
    'Rights of accused during trial?',
    'Can trial be fast-tracked? Conditions?',
    'Framing of charges procedure?',
    'Discharge vs acquittal - legal distinction?',
    'Trial in absentia - when permissible?',
    'Witness examination procedure?',
    'Cross-examination rights and limits?',
    'Court commissioner examination - when used?',
    'Evidence recording in trial?',
    'Defence evidence presentation?',
    'Final arguments and written submissions?',
    'Judgment delivery timeline?',
    'Split trial - when ordered?',
    'De novo trial - circumstances?',
    'Joint trial of multiple accused?',
    'Separate trial for co-accused - when?',
    'Victim participation in trial?',
    'In-camera trial provisions?',
    'Video conferencing in trial?',
    'Speedy trial - constitutional right?',
    'Trial by jury vs judge alone?',
    'Summary trial procedure?',
    'Is WhatsApp chat admissible?',
    'Who certifies electronic evidence?',
    'CCTV footage without certificate ‚Äì valid?',
    'Can call records be primary evidence?',
    'Hostile witness treatment under BSA?'
  ],
  
  appeals: [
    'How to file appeal under BNSS?',
    'Appeal time limits from different courts?',
    'Limitation period for appeal?',
    'High Court vs Supreme Court appeals - differences?',
    'Appeal procedure and documentation?',
    'Can appeal be filed online?',
    'Cost of filing appeals?',
    'Suspension of sentence pending appeal?',
    'Revision petition vs appeal - distinction?',
    'Difference between revision and appeal?',
    'Powers of appellate court?',
    'Fresh evidence in appeal - when allowed?',
    'Appeal against acquittal - procedure?',
    'Appeal against conviction and sentence?',
    'Appeal by State vs appeal by accused?',
    'Condonation of delay in appeal?',
    'Withdrawal of appeal - procedure?',
    'Acquittal on appeal - consequences?',
    'Enhanced sentence on appeal - legality?',
    'Compounding of offences during appeal?',
    'Legal aid for appeals?',
    'Reference to High Court - circumstances?',
    'Special Leave Petition to Supreme Court?',
    'Interim relief during appeal?',
    'Stay on conviction possible?'
  ],
  
  punishments: [
    'What changed from IPC to BNS in punishments?',
    'Punishment for theft under BNS?',
    'Sentencing guidelines under new laws?',
    'Mitigating factors in sentencing?',
    'Maximum punishment for murder?',
    'Death penalty - current status under BNS?',
    'Life imprisonment provisions?',
    'Community service as alternative punishment?',
    'Fine as punishment - maximum limits?',
    'Compensation to victims - mandatory provisions?',
    'Suspended sentence and probation?',
    'First-time offender - leniency provisions?',
    'Juvenile sentencing - special provisions?',
    'Concurrent vs consecutive sentences?',
    'Minimum sentences for specific offences?',
    'Enhanced punishment for repeat offenders?',
    'Remission and commutation of sentences?',
    'Presidential pardon provisions?',
    'Punishment for corporate crimes?',
    'Sentencing in plea bargaining?'
  ],
  
  procedures: [
    'How to file criminal case in court?',
    'Court documentation and format requirements?',
    'Timeline for court hearings?',
    'Court fees structure for criminal cases?',
    'How to get certified copies of court orders?',
    'Case diary access by accused?',
    'Filing of complaints under Section 200 BNSS?',
    'Private complaint procedure?',
    'Condonation of delay in filing?',
    'Application for summons to witnesses?',
    'Vakalatnama and authorization to appear?',
    'Adjournment of cases - grounds?',
    'Production of documents in court?',
    'Examination of accused under Section 313?',
    'Application for discharge?',
    'Bail application format and grounds?',
    'Interim orders during trial?',
    'Court recording of evidence?',
    'Petition for transfer of case?',
    'Stay of proceedings - when granted?'
  ],
  
  comparison: [
    'Key changes from IPC to BNS?',
    'Major differences between BNSS and CrPC?',
    'BSA vs Evidence Act - what changed?',
    'Why were criminal laws changed in 2024?',
    'Implementation timeline for new laws?',
    'Sections renumbered - how to find correspondence?',
    'New offences added in BNS?',
    'Offences removed from IPC?',
    'Punishment changes - increased or decreased?',
    'Procedural changes in BNSS?',
    'Electronic evidence provisions - new additions?',
    'Time limits changed in new laws?',
    'Bail provisions - what is different?',
    'Investigation powers - expanded or restricted?',
    'Victim rights - enhanced provisions?',
    'Women and children - special protections added?',
    'Cybercrime provisions in new laws?',
    'Economic offences - new provisions?',
    'Community service - new concept?',
    'Plea bargaining - any changes?',
    'Appeals and revision - modified provisions?',
    'Language and terminology changes?',
    'Transitional provisions for pending cases?',
    'Savings clause - what continues?',
    'Training and adaptation challenges?',
    'FIR process: CrPC vs BNSS',
    'Arrest rules: Old vs New law',
    'Evidence law changes summary',
    'New timelines introduced',
    'Technology use in new laws'
  ],
  
  // ========== LAW STUDENT QUESTIONS ==========
  
  concepts: [
    'Mens rea - detailed explanation with examples?',
    'What is mens rea in simple words?',
    'Actus reus - what constitutes criminal act?',
    'Criminal liability - how is it established?',
    'Strict liability vs absolute liability?',
    'Vicarious liability - scope and limits?',
    'Joint liability - common intention vs common object?',
    'Constructive liability - meaning?',
    'Right of private defence - when justified?',
    'General exceptions to criminal liability?',
    'Age of criminal responsibility - legal provisions?',
    'Unsoundness of mind - defence?',
    'Intoxication - voluntary vs involuntary?',
    'Necessity as defence - legal validity?',
    'Mistake of fact vs mistake of law?',
    'Doctrine of transferred malice?',
    'Doctrine of common intention?',
    'Doctrine of mens rea in statutory offences?',
    'Principle of nulla poena sine lege?',
    'Doctrine of double jeopardy?',
    'Burden of proof in criminal cases?',
    'What is burden of proof?',
    'Standard of proof - beyond reasonable doubt?',
    'Presumption of innocence - application?',
    'What is presumption under law?',
    'Corpus delicti - essential requirement?',
    'Motive vs intention - legal distinction?',
    'Criminal negligence vs civil negligence?'
  ],
  
  criminal: [
    'Classification of offences under BNS?',
    'Meaning of cognizable offence with example?',
    'Difference between bailable and non-bailable?',
    'Crimes against human body - categories?',
    'Crimes against property - types?',
    'Crimes against state - treason, sedition?',
    'Crimes against public tranquility?',
    'Crimes related to elections?',
    'Crimes by or relating to public servants?',
    'Contempt of lawful authority?',
    'Offences affecting public health and safety?',
    'Offences relating to religion?',
    'Offences affecting human body - murder to assault?',
    'Sexual offences - comprehensive overview?',
    'Offences against women - special provisions?',
    'Offences relating to marriage?',
    'Defamation - criminal provisions?',
    'Criminal intimidation and insult?',
    'Theft, extortion, robbery, dacoity?',
    'Cheating and fraud?',
    'Criminal breach of trust?',
    'Forgery and document fraud?',
    'Currency offences?',
    'Cybercrime under BNS?',
    'Economic offences?',
    'Environmental crimes?',
    'Organized crime and terrorism?'
  ],
  
  procedure: [
    'FIR to judgment - complete process?',
    'Preliminary investigation before FIR?',
    'Investigation powers and duties?',
    'Arrest procedures and safeguards?',
    'Search and seizure - legal requirements?',
    'Remand to police custody - procedure?',
    'Bail application and hearing?',
    'Charge sheet filing - timeline and format?',
    'Cognizance by magistrate - process?',
    'Framing of charges - procedure?',
    'Trial procedure in sessions court?',
    'Recording of evidence - examination stages?',
    'Defence evidence presentation?',
    'Arguments - prosecution and defence?',
    'Judgment writing - requirements?',
    'Sentencing hearing and factors?',
    'Appeal procedure and time limits?',
    'Revision petition - when maintainable?',
    'Review of judgment - grounds?',
    'Reference to High Court?',
    'Special leave petition to Supreme Court?',
    'Execution of sentences?',
    'Probation and suspended sentence?',
    'Remission and pardon?',
    'Victim compensation - procedure?'
  ],
  
  evidence_law: [
    'Types of evidence - direct, circumstantial, documentary?',
    'Oral evidence vs documentary evidence?',
    'Primary evidence vs secondary evidence?',
    'Admissibility of evidence - tests?',
    'Relevancy of evidence - determining factors?',
    'Facts in issue and relevant facts?',
    'Burden of proof - who bears it?',
    'Standard of proof in criminal vs civil?',
    'Presumptions - rebuttable and conclusive?',
    'Confession - admissibility conditions?',
    'Dying declaration - evidentiary value?',
    'Expert evidence - when required?',
    'Opinion evidence - admissibility?',
    'Character evidence - when relevant?',
    'Previous judgments as evidence?',
    'Electronic evidence under BSA?',
    'Digital signatures and certificates?',
    'CCTV footage authentication?',
    'Social media evidence?',
    'Email and SMS as evidence?',
    'Voice recognition and call records?',
    'DNA evidence - admissibility?',
    'Lie detector and narco tests?',
    'Witness examination - chief, cross, re-examination?',
    'Impeaching witness credibility?'
  ],
  
  amendments: [
    'Why IPC was replaced by BNS?',
    'Objectives of BNSS in simple terms?',
    'Why Evidence Act was changed?',
    'What problems old laws had?',
    'Most significant changes in criminal laws?',
    'New offences introduced in BNS?',
    'Enhanced punishments - which crimes?',
    'Reduced punishments - any instances?',
    'Time-bound investigation provisions?',
    'Victim rights - new additions?',
    'Technology integration - major changes?',
    'Simplified language - impact?',
    'Gender-neutral provisions?',
    'Community service - implementation?',
    'Forensic investigation - mandatory provisions?',
    'Electronic service of summons?',
    'Video conferencing in trial?',
    'Witness protection scheme?',
    'Speedy trial provisions?',
    'Bail reforms?',
    'Plea bargaining changes?',
    'Juvenile justice amendments?',
    'Economic crime provisions?',
    'International cooperation provisions?'
  ],
  
  casestudies: [
    'Landmark judgments under new criminal laws?',
    'Case study: FIR registration issues?',
    'Case study: Bail application denied/granted?',
    'Example: Investigation procedure in cyberfraud?',
    'Case study: Trial procedure in murder case?',
    'Example: Evidence presentation in court?',
    'Case study: Appeal after conviction?',
    'Example: Compounding of offences?',
    'Case study: Juvenile justice case?',
    'Example: Anticipatory bail application?',
    'Case study: Victim compensation awarded?',
    'Example: Witness protection case?',
    'Case study: Electronic evidence admissibility?',
    'Example: Community service as punishment?',
    'Case study: Plea bargaining success?',
    'Example: Private defence justified?',
    'Case study: General exceptions applied?',
    'Example: Joint trial of multiple accused?',
    'Case study: Reference to High Court?',
    'Example: Practical application of new laws?'
  ],
  
  // ========== GENERAL CITIZEN QUESTIONS ==========
  
  rights: [
    'What are my rights if arrested?',
    'Can I refuse to give statement to police?',
    'When do I get right to lawyer?',
    'What are my rights during police interrogation?',
    'What if my rights are violated by police?',
    'Right to bail - am I entitled?',
    'Right to medical examination when arrested?',
    'Does police have to inform my family?',
    'Can police search my house without warrant?',
    'Right against self-incrimination - what is it?',
    'What if I do not understand the language?',
    'Right to food and basic needs in custody?',
    'How often can I meet my lawyer?',
    'Can I remain silent during questioning?',
    'Special rights for women accused?',
    'Rights of senior citizens in criminal cases?',
    'Right to speedy trial - how long should case take?',
    'Can I cross-examine witnesses?',
    'Right to appeal if convicted?',
    'Compensation if wrongfully arrested?',
    'Rights during court trial?',
    'Right to interpreter in court?',
    'Rights of victims in criminal cases?',
    'Right to legal aid if I cannot afford lawyer?',
    'Constitutional rights in criminal proceedings?',
    'Can police call me without written notice?',
    'Can police arrest at night?',
    'Can police arrest without telling reason?',
    'What should I do if police misbehave?',
    'Can mobile be taken by police?'
  ],
  
  complaint: [
    'How do I file FIR?',
    'Where can I register FIR?',
    'Can I file FIR online?',
    'Can FIR be lodged through email or online?',
    'What if police station refuses FIR?',
    'What if police delay FIR registration?',
    'What is Zero FIR and when to use?',
    'What information should I give in complaint?',
    'Do I need documents for FIR?',
    'What documents are needed to file FIR?',
    'How to file complaint for cybercrime?',
    'Online complaint to National Commission for Women?',
    'Consumer court complaint process?',
    'How to complain about police officer?',
    'Complaint to Human Rights Commission?',
    'Anonymous complaint - is it valid?',
    'Oral vs written complaint?',
    'Time limit for filing FIR?',
    'Can I get copy of my FIR?',
    'What happens after FIR is registered?',
    'Private complaint in court - procedure?',
    'How to file complaint for cheating?',
    'Property dispute complaint - where to file?',
    'Workplace harassment complaint?',
    'Domestic violence complaint procedure?',
    'Missing person complaint?',
    'Accident complaint and insurance claim?',
    'Online fraud complaint - step by step?',
    'Can a family member file FIR on my behalf?',
    'Is FIR free of cost?',
    'Can FIR be withdrawn later?'
  ],
  
  bail: [
    'What is bail and who can get it?',
    'How to apply for bail?',
    'How much does bail cost?',
    'How much time does it take to get bail?',
    'What are bail conditions?',
    'Can bail be given during investigation?',
    'What is anticipatory bail?',
    'How long does bail process take?',
    'What if bail is rejected?',
    'Who can stand surety for bail?',
    'Who can apply for bail on my behalf?',
    'Can I travel if on bail?',
    'Regular bail vs interim bail?',
    'Bail for women - any special provisions?',
    'Bail for senior citizens?',
    'When can bail be cancelled?',
    'What happens if bail conditions are violated?',
    'Default bail - what is it?',
    'How to get bail in non-bailable case?',
    'Personal bond vs surety bail?',
    'Reporting to police station while on bail?',
    'Bail in serious crimes like murder?',
    'Release on personal recognizance?',
    'Is bail possible on the same day of arrest?',
    'Can police oppose bail?'
  ],
  
  common: [
    'What to do if my mobile is stolen?',
    'Vehicle accident - what steps to take?',
    'Property dispute with neighbor - resolution?',
    'Cheque bounced - what is remedy?',
    'Online shopping fraud - how to complain?',
    'Landlord-tenant dispute handling?',
    'Workplace harassment - what to do?',
    'Domestic violence - immediate help?',
    'Lost important documents - procedure?',
    'Credit card fraud - steps to take?',
    'Defamation case - how to handle?',
    'Physical assault - what should I do?',
    'Robbery at home - immediate actions?',
    'Bike/car stolen - reporting process?',
    'Threatened by someone - legal help?',
    'Money not returned by friend - options?',
    'Fake social media profile - complaint?',
    'Neighbour causing nuisance - remedy?',
    'Child missing - what to do immediately?',
    'Dowry harassment - legal remedies?',
    'Will dispute in family?',
    'Marriage fraud case?',
    'Job fraud and fake placement - complaint?',
    'Electricity/water theft by neighbor?',
    'Stray animal causing damage - liability?',
    'Can case be settled outside court?',
    'How long does criminal case take?',
    'What happens if accused does not cooperate?',
    'Can police close case without informing complainant?'
  ],
  
  legal_aid: [
    'How to get free legal aid?',
    'Who is eligible for free legal services?',
    'Legal aid helpline numbers?',
    'Government legal aid authorities?',
    'District Legal Services Authority - how to contact?',
    'NGOs providing free legal help?',
    'Online legal consultation services?',
    'Lawyer fees - typical costs?',
    'How to find good criminal lawyer?',
    'Legal aid for women?',
    'Legal help for senior citizens?',
    'Free legal aid for SC/ST/OBC?',
    'Legal aid for persons with disabilities?',
    'Victim legal services?',
    'Legal aid in custody?',
    'Legal awareness programs?',
    'Mobile legal aid clinics?',
    'Tele-law services?',
    'Legal aid mobile apps?',
    'Pro bono legal services?'
  ],
  
  cybercrime: [
    'How to report online fraud?',
    'What to do if money is deducted online fraud?',
    'Cyber police station - where to find?',
    'National Cybercrime Reporting Portal?',
    'Online harassment complaint procedure?',
    'Social media account hacked - what to do?',
    'Fake profile impersonating me - remedy?',
    'Online blackmail and extortion - help?',
    'Cyberstalking - how to complain?',
    'Revenge porn - legal remedies?',
    'Phishing attack - reporting process?',
    'UPI fraud - immediate steps?',
    'Banking fraud online - whom to inform?',
    'Can bank reverse fraud amount?',
    'Online job scam - complaint?',
    'Dating app fraud - legal action?',
    'Cyber bullying - how to stop?',
    'Obscene messages - legal remedy?',
    'Morphed photos circulated - what to do?',
    'Online defamation - legal options?',
    'Video call blackmail - help?',
    'Email hacking - complaint procedure?',
    'Identity theft online - steps?',
    'Online gaming fraud?',
    'Fake website cheating - complaint?',
    'Digital arrest scam - awareness?',
    'How to protect myself online?',
    'How quickly should cyber complaint be filed?',
    'Is cyber complaint possible without FIR?',
    'Is cyber crime complaint anonymous?'
  ],
  
  women: [
    'Domestic violence - immediate help?',
    'Dowry harassment - legal remedy?',
    'Sexual harassment - where to complain?',
    'Acid attack - legal help and compensation?',
    'Rape - medical and legal procedure?',
    'Stalking - legal protection?',
    'Eve teasing - what to do?',
    'Women helpline numbers?',
    'What is emergency number for women?',
    'Mahila police station - services?',
    'Protection of Women from Domestic Violence Act?',
    'Child abuse - reporting procedure?',
    'Child sexual abuse - immediate steps?',
    'Missing child - what to do?',
    'Child marriage - how to prevent?',
    'POCSO Act - what does it cover?',
    'Child helpline number?',
    'Juvenile justice - who it applies to?',
    'Maintenance for wife and children?',
    'Divorce and domestic violence?',
    'Protection from husband family?',
    'Working women harassment - complaint?',
    'Maternity rights?',
    'Sexual harassment at workplace - procedure?',
    'Women safety apps?',
    'Legal aid for women?',
    'Can woman be arrested by male police?',
    'What time police can arrest a woman?',
    'Is complaint mandatory in women cases?',
    'What rights does a minor have during inquiry?'
  ],
  
  basics: [
    'What is FIR in simple words?',
    'What does cognizable offence mean?',
    'Bailable vs non-bailable - simple explanation?',
    'What is police custody?',
    'What is judicial custody?',
    'What is charge sheet?',
    'Bail - simple definition?',
    'What is arrest warrant?',
    'What is summons?',
    'Court - different types explained?',
    'What is trial?',
    'Judge vs Magistrate - difference?',
    'What is appeal?',
    'What is conviction?',
    'What is acquittal?',
    'Punishment - types explained?',
    'What is fine?',
    'Life imprisonment - how many years?',
    'What is lawyer role?',
    'Public prosecutor - who is this?',
    'How long can police keep someone in custody?'
  ]
};    
    // FIXED: Proper radio button handling
    function selectQueryType(type) {
      selectedQueryType = type;
      
      const customCard = document.getElementById('customCard');
      const readyCard = document.getElementById('readyCard');
      const customDiv = document.getElementById('customQuestionDiv');
      const readyDiv = document.getElementById('readyQuestionDiv');
      
      // Remove selected class from both
      customCard.classList.remove('selected');
      readyCard.classList.remove('selected');
      
      if (type === 'custom') {
        customCard.classList.add('selected');
        document.querySelector('input[value="custom"]').checked = true;
        customDiv.style.display = 'block';
        readyDiv.style.display = 'none';
      } else {
        readyCard.classList.add('selected');
        document.querySelector('input[value="ready"]').checked = true;
        customDiv.style.display = 'none';
        readyDiv.style.display = 'block';
        
        // IMPORTANT: If profile already selected, show topics immediately
        if (selectedUser) {
          loadTopics(selectedUser);
          document.getElementById('topicSection').style.display = 'block';
          console.log('‚úÖ Topics loaded for already-selected user:', selectedUser);
        } else {
          // Hide topics until profile is selected
          document.getElementById('topicSection').style.display = 'none';
          console.log('‚ö†Ô∏è No profile selected yet - topics hidden');
        }
      }
      
      console.log('‚úÖ Query type selected:', type);
    }
    
    window.selectQueryType = selectQueryType;

    // Select main user profile (always visible)
    function selectMainUser(userType) {
      selectedUser = userType;
      
      // Update main profile cards
      document.querySelectorAll('.user-card-small').forEach(el => el.classList.remove('selected'));
      const mainCard = document.getElementById('user' + userType.charAt(0).toUpperCase() + userType.slice(1) + 'Main');
      if (mainCard) mainCard.classList.add('selected');
      
      // Update hint text
      const userNames = {
        police: 'Police Officer - Get practical, procedural answers',
        legal: 'Legal Professional - Get detailed technical analysis',
        student: 'Student/Researcher - Get educational explanations',
        citizen: 'General Citizen - Get simple, practical guidance'
      };
      
      document.getElementById('profileHint').textContent = '‚úì Selected: ' + userNames[userType];
      
      // If ready-made questions section is visible, load topics automatically
      const readyDiv = document.getElementById('readyQuestionDiv');
      if (readyDiv && readyDiv.style.display !== 'none') {
        loadTopics(userType);
        document.getElementById('topicSection').style.display = 'block';
      }
      
      console.log('‚úÖ Main user profile selected:', userType);
    }
    
    window.selectMainUser = selectMainUser;

    function selectUser(userType) {
      // This function is now deprecated - selectMainUser handles everything
      selectMainUser(userType);
    }
    
    window.selectUser = selectUser;

    function loadTopics(userType) {
      const container = document.getElementById('topicContainer');
      container.innerHTML = '';
      
      const topics = TOPICS[userType] || [];
      
      topics.forEach(function(topic) {
        const topicCard = document.createElement('div');
        topicCard.className = 'topic-card';
        topicCard.id = 'topic-' + topic.id;
        topicCard.onclick = function() { selectTopic(topic.id); };
        
        topicCard.innerHTML = '<div class="topic-icon">' + topic.icon + '</div>' +
          '<div class="flex-1">' +
          '<div class="topic-title">' + topic.title + '</div>' +
          '<div class="topic-subtitle">' + topic.subtitle + '</div>' +
          '<div class="topic-law">' + topic.law + '</div>' +
          '</div>';
        
        container.appendChild(topicCard);
      });
    }

    function selectTopic(topicId) {
      selectedTopic = topicId;
      
      // Update UI
      document.querySelectorAll('.topic-card').forEach(function(el) {
        el.classList.remove('selected');
      });
      const topicCard = document.getElementById('topic-' + topicId);
      if (topicCard) topicCard.classList.add('selected');
      
      // Load questions for this topic
      loadQuestionsForTopic(topicId);
      
      // Show question section
      document.getElementById('questionSelectSection').style.display = 'block';
      
      console.log('‚úÖ Topic selected:', topicId);
    }

    function loadQuestionsForTopic(topicId) {
      const questionSelect = document.getElementById('questionSelect');
      questionSelect.innerHTML = '<option value="" selected disabled>Select a question...</option>';
      
      const questions = TOPIC_QUESTIONS[topicId] || [];
      
      questions.forEach(function(q) {
        const option = document.createElement('option');
        option.value = q;
        option.textContent = q;
        questionSelect.appendChild(option);
      });
    }

    document.getElementById('questionSelect').addEventListener('change', function() {
      document.getElementById('userInput').value = this.value;
    });

    // Voice recognition
    let recognition;
    let isRecording = false;

    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'hi-IN';

      recognition.onstart = function() {
        isRecording = true;
        document.getElementById('voiceBtn').classList.add('recording');
      };

      recognition.onresult = function(event) {
        document.getElementById('userInput').value = event.results[0][0].transcript;
      };

      recognition.onend = function() {
        isRecording = false;
        document.getElementById('voiceBtn').classList.remove('recording');
      };

      recognition.onerror = function() {
        isRecording = false;
        document.getElementById('voiceBtn').classList.remove('recording');
      };
    }

    document.getElementById('voiceBtn').addEventListener('click', function(e) {
      e.preventDefault();
      if (recognition) {
        if (isRecording) {
          recognition.stop();
        } else {
          recognition.start();
        }
      } else {
        alert('Voice recognition not supported');
      }
    });

    document.getElementById('submitBtn').addEventListener('click', async function() {
      const question = document.getElementById('userInput').value.trim();
      
      if (!question) {
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç! / Please enter your question!');
        return;
      }
      
      // Profile is always selected (default: citizen) so no need to validate
      // But show a gentle reminder if user hasn't explicitly selected
      if (selectedUser === 'citizen' && !document.getElementById('userCitizenMain').classList.contains('selected')) {
        console.log('‚ÑπÔ∏è Using default profile: General Citizen');
      }
      
      // Reset for new question
      currentQuestion = question;
      currentAnswerLevel = 'standard'; // Default to standard
      aiUsed = { groq: true, chatgpt: false };
      
      // Always use Groq first (fastest) with standard depth
      await getAnswer('groq', 'standard');
    });

    document.getElementById('closeModal').addEventListener('click', function() {
      document.getElementById('aiModal').classList.add('hidden');
    });

    document.getElementById('closeBtn').addEventListener('click', function() {
      document.getElementById('aiModal').classList.add('hidden');
    });

    // WhatsApp Share Function
    function shareOnWhatsApp() {
      const question = document.getElementById('modalQuestion').textContent;
      const answer = document.getElementById('modalAnswer').textContent;
      
      const message = '*NyayaMitra 2024 - New Criminal Laws*\n\n' +
                      '*Question:*\n' + question + '\n\n' +
                      '*Answer:*\n' + answer.substring(0, 400) + '...\n\n' +
                      'Get more info at NyayaMitra 2024';
      
      const whatsappUrl = 'https://wa.me/?text=' + encodeURIComponent(message);
      window.open(whatsappUrl, '_blank');
      console.log('‚úÖ Shared on WhatsApp');
    }
    
    window.shareOnWhatsApp = shareOnWhatsApp;

    // Extract Keywords from User's Question
    function extractKeywords(question) {
      // Convert to lowercase for processing
      const text = question.toLowerCase();
      
      // Remove common question words
      const stopWords = ['what', 'when', 'where', 'how', 'why', 'who', 'is', 'are', 'the', 'a', 'an', 
                         'can', 'could', 'should', 'would', 'do', 'does', 'did', 'have', 'has', 'had',
                         'will', 'shall', 'may', 'might', 'must', '‡§ï‡•ã', '‡§ï‡§æ', '‡§ï‡•á', '‡§Æ‡•á‡§Ç', '‡§∏‡•á', '‡§π‡•à', '‡§π‡•à‡§Ç'];
      
      // Split into words and filter
      const words = text.split(/\s+/)
        .filter(word => word.length > 2)  // At least 3 characters
        .filter(word => !stopWords.includes(word))
        .filter(word => !/^\d+$/.test(word));  // Remove pure numbers
      
      // Take first 4-5 meaningful words as keywords
      const keywords = words.slice(0, 5);
      
      // If we have very few keywords, try to extract key phrases
      if (keywords.length < 3) {
        // Look for important legal terms
        const importantTerms = [
          'arrest', 'bail', 'fir', 'complaint', 'investigation', 'search', 'seizure',
          'evidence', 'witness', 'trial', 'court', 'judge', 'lawyer', 'police',
          'custody', 'detention', 'rights', 'punishment', 'crime', 'offence',
          'murder', 'theft', 'fraud', 'rape', 'kidnapping', 'cybercrime',
          'electronic', 'digital', 'cyber', 'appeal', 'revision', 'judgment',
          'charge', 'chargesheet', 'confession', 'anticipatory', 'cognizable',
          'bailable', 'warrant', 'summons', 'victim', 'compensation'
        ];
        
        importantTerms.forEach(term => {
          if (text.includes(term) && !keywords.includes(term)) {
            keywords.push(term);
          }
        });
      }
      
      return keywords.filter((v, i, a) => a.indexOf(v) === i); // Remove duplicates
    }

    // Open Section Search with Keywords from Question
    function openSectionSearch() {
      // Get the original question
      const question = document.getElementById('modalQuestion').textContent;
      
      if (question && question.trim()) {
        // Extract keywords from the question
        const keywords = extractKeywords(question);
        
        if (keywords.length > 0) {
          // Build URL with keywords
          const searchQuery = keywords.join('+');
          const url = 'section-search.html?search=' + encodeURIComponent(searchQuery);
          window.open(url, '_blank');
          console.log('‚úÖ Opening section search with keywords:', keywords.join(' '));
        } else {
          // Fallback: open without keywords
          window.open('section-search.html', '_blank');
          console.log('‚ö†Ô∏è No keywords extracted, opening section search');
        }
      } else {
        // No question available, just open section search
        window.open('section-search.html', '_blank');
        console.log('‚úÖ Opening section search (no question available)');
      }
    }
    
    window.openSectionSearch = openSectionSearch;

    // Ask a Related Question
    function askRelatedQuestion(question) {
      console.log('üìã Related question clicked:', question);
      console.log('üìã Auto-submitting related question...');
      
      // Close the modal first
      document.getElementById('aiModal').classList.add('hidden');
      
      // Set the question in the input
      document.getElementById('userInput').value = question;
      
      // Update current question
      currentQuestion = question;
      
      // Scroll to input
      document.getElementById('userInput').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center' 
      });
      
      // Brief highlight
      const input = document.getElementById('userInput');
      input.style.backgroundColor = '#fef3c7';
      input.focus();
      
      // AUTO-SUBMIT after short delay
      setTimeout(() => {
        input.style.backgroundColor = '';
        console.log('üöÄ Auto-submitting question now...');
        // Trigger the answer
        getAnswer('groq', 'standard');
      }, 800);  // 800ms delay to show the question briefly
    }
    
    window.askRelatedQuestion = askRelatedQuestion;

    // Autocomplete Suggestions for Custom Questions
    function showAutocompleteSuggestions() {
      const input = document.getElementById('userInput');
      const suggestionsBox = document.getElementById('autocompleteSuggestions');
      const query = input.value.toLowerCase().trim();
      
      // Hide if input is too short
      if (query.length < 3) {
        suggestionsBox.classList.add('hidden');
        return;
      }
      
      // Get all questions from TOPIC_QUESTIONS
      const allQuestions = [];
      for (const topic in TOPIC_QUESTIONS) {
        allQuestions.push(...TOPIC_QUESTIONS[topic]);
      }
      
      // Filter matching questions
      const matches = allQuestions.filter(q => 
        q.toLowerCase().includes(query)
      ).slice(0, 10); // Limit to 10 suggestions
      
      // Show suggestions
      if (matches.length > 0) {
        suggestionsBox.innerHTML = matches.map(q => `
          <div class="p-3 hover:bg-orange-50 cursor-pointer border-b border-orange-100 text-sm transition"
               onclick="selectSuggestion('${q.replace(/'/g, "\\'")}')">
            ${q}
          </div>
        `).join('');
        suggestionsBox.classList.remove('hidden');
      } else {
        suggestionsBox.classList.add('hidden');
      }
    }
    
    function selectSuggestion(question) {
      const input = document.getElementById('userInput');
      const suggestionsBox = document.getElementById('autocompleteSuggestions');
      
      input.value = question;
      suggestionsBox.classList.add('hidden');
      input.focus();
    }
    
    // Hide suggestions when clicking outside
    document.addEventListener('click', function(event) {
      const suggestionsBox = document.getElementById('autocompleteSuggestions');
      const input = document.getElementById('userInput');
      
      if (!suggestionsBox.contains(event.target) && event.target !== input) {
        suggestionsBox.classList.add('hidden');
      }
    });
    
    console.log('‚úÖ NyayaMitra ready with autocomplete!');

  </script>

</body>
</html>
