<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LawBot 2024 â€“ New Criminal Laws Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .fade-in {
      animation: fadeIn 0.6s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .autocomplete-item {
      transition: all 0.2s;
    }
    .autocomplete-item:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateX(5px);
    }
    .feature-card {
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body class="p-4">

  <div class="max-w-6xl mx-auto">
    
    <!-- Header with Logo -->
    <div class="glass-effect rounded-3xl shadow-2xl p-6 mb-6 fade-in text-center">
      <div class="flex items-center justify-center gap-4 mb-3">
        <div class="w-16 h-16 bg-gradient-to-br from-purple-600 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg">
          <i data-lucide="scale" class="w-10 h-10 text-white"></i>
        </div>
        <div class="text-left">
          <h1 class="text-4xl font-black bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
            LawBot 2024
          </h1>
          <p class="text-sm text-gray-600 font-medium">Your AI Assistant for New Criminal Laws 2024</p>
        </div>
      </div>
      <div class="flex items-center justify-center gap-2 text-xs text-gray-500">
        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full font-semibold">BNS 2023</span>
        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full font-semibold">BNSS 2023</span>
        <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full font-semibold">BSA 2023</span>
        <span class="px-3 py-1 bg-pink-100 text-pink-700 rounded-full font-semibold">Powered by Groq AI</span>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- Left Panel - Quick Actions -->
      <div class="lg:col-span-1 space-y-6">
        
        <!-- User Input Card -->
        <div class="glass-effect rounded-2xl shadow-xl p-5 fade-in">
          <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
            <i data-lucide="user" class="w-5 h-5 text-purple-600"></i>
            Your Details
          </h3>
          <input id="userName" class="w-full rounded-lg border-2 border-purple-200 focus:ring-2 focus:ring-purple-600 focus:border-purple-600 p-3 text-sm" 
            placeholder="Enter your name" />
        </div>

        <!-- Language & Voice -->
        <div class="glass-effect rounded-2xl shadow-xl p-5 fade-in">
          <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
            <i data-lucide="languages" class="w-5 h-5 text-purple-600"></i>
            Language & Input
          </h3>
          
          <!-- Language Radio Buttons -->
          <div class="space-y-2 mb-4">
            <label class="flex items-center gap-3 cursor-pointer hover:bg-purple-50 p-2 rounded-lg transition">
              <input type="radio" name="language" value="English" checked class="w-4 h-4 text-purple-600" />
              <span class="text-sm font-medium text-gray-700">ðŸ‡¬ðŸ‡§ English</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer hover:bg-purple-50 p-2 rounded-lg transition">
              <input type="radio" name="language" value="Hindi" class="w-4 h-4 text-purple-600" />
              <span class="text-sm font-medium text-gray-700">ðŸ‡®ðŸ‡³ Hindi (à¤¹à¤¿à¤‚à¤¦à¥€)</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer hover:bg-purple-50 p-2 rounded-lg transition">
              <input type="radio" name="language" value="Punjabi" class="w-4 h-4 text-purple-600" />
              <span class="text-sm font-medium text-gray-700">ðŸ‡®ðŸ‡³ Punjabi (à¨ªà©°à¨œà¨¾à¨¬à©€)</span>
            </label>
          </div>

          <!-- Voice Input Button -->
          <button id="voiceBtn" class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-3 rounded-xl shadow-lg hover:shadow-xl transition font-semibold">
            <i data-lucide="mic" class="w-5 h-5"></i>
            <span>Speak Your Question</span>
          </button>
          <p class="text-xs text-gray-500 text-center mt-2">Click and speak in your selected language</p>
        </div>

        <!-- Quick Action Buttons -->
        <div class="glass-effect rounded-2xl shadow-xl p-5 fade-in">
          <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
            <i data-lucide="zap" class="w-5 h-5 text-purple-600"></i>
            Quick Actions
          </h3>
          <div class="space-y-2">
            <button onclick="window.location.href='section-search.html'" class="w-full flex items-center gap-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-3 rounded-xl shadow hover:shadow-lg transition font-semibold">
              <i data-lucide="database" class="w-5 h-5"></i>
              Search 70 Sections
            </button>
            <button onclick="window.location.href='index.html'" class="w-full flex items-center gap-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-xl shadow hover:shadow-lg transition font-semibold">
              <i data-lucide="home" class="w-5 h-5"></i>
              Main Page
            </button>
          </div>
        </div>

        <!-- Quote of the Day -->
        <div class="glass-effect rounded-2xl shadow-xl p-5 fade-in bg-gradient-to-br from-purple-50 to-pink-50">
          <div class="flex items-start gap-3">
            <i data-lucide="quote" class="w-8 h-8 text-purple-600 mt-1"></i>
            <div>
              <p class="text-sm font-semibold text-gray-800 mb-2">"Justice delayed is justice denied."</p>
              <p class="text-xs text-gray-600">The new criminal laws aim to ensure speedy justice for all citizens of India.</p>
            </div>
          </div>
        </div>

      </div>

      <!-- Right Panel - Main Chat Interface -->
      <div class="lg:col-span-2 space-y-6">
        
        <!-- Question Input with Autocomplete -->
        <div class="glass-effect rounded-2xl shadow-xl p-6 fade-in">
          <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i data-lucide="message-square" class="w-5 h-5 text-purple-600"></i>
            Ask Your Legal Question
          </h3>
          
          <!-- Search/Autocomplete Input -->
          <div class="relative mb-4">
            <div class="relative">
              <i data-lucide="search" class="absolute left-4 top-4 w-5 h-5 text-gray-400"></i>
              <input id="questionInput" type="text" 
                class="w-full pl-12 pr-4 py-4 rounded-xl border-2 border-purple-200 focus:ring-2 focus:ring-purple-600 focus:border-purple-600 text-sm" 
                placeholder="Type your question or search from ready-made questions below..."
                oninput="showAutocomplete()" 
                onfocus="showAutocomplete()"
                autocomplete="off" />
            </div>
            
            <!-- Autocomplete Dropdown -->
            <div id="autocompleteDropdown" class="hidden absolute z-10 w-full mt-2 bg-white rounded-xl shadow-2xl border border-gray-200 max-h-64 overflow-y-auto">
              <!-- Suggestions will be inserted here -->
            </div>
          </div>

          <!-- Character Count -->
          <div class="flex justify-between items-center mb-4">
            <span id="charCount" class="text-xs text-gray-500">0 / 500 characters</span>
            <button onclick="document.getElementById('questionInput').value=''" class="text-xs text-purple-600 hover:text-purple-800 font-semibold">
              Clear
            </button>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-3">
            <button id="askBtn" class="flex-1 flex items-center justify-center gap-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-4 rounded-xl shadow-lg hover:shadow-xl transition font-bold text-lg">
              <i data-lucide="send" class="w-5 h-5"></i>
              <span>Ask LawBot</span>
            </button>
          </div>
          <p id="statusText" class="text-sm text-center mt-3 text-gray-600"></p>
        </div>

        <!-- Ready-Made Questions -->
        <div class="glass-effect rounded-2xl shadow-xl p-6 fade-in">
          <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i data-lucide="help-circle" class="w-5 h-5 text-purple-600"></i>
            Popular Questions
          </h3>
          <div id="readyQuestions" class="grid grid-cols-1 md:grid-cols-2 gap-3 max-h-96 overflow-y-auto pr-2">
            <!-- Questions will be inserted here -->
          </div>
        </div>

        <!-- Features Info -->
        <div class="grid grid-cols-2 gap-4">
          <div class="glass-effect rounded-xl p-4 text-center feature-card">
            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-2">
              <i data-lucide="brain" class="w-6 h-6 text-purple-600"></i>
            </div>
            <h4 class="font-bold text-sm text-gray-800">AI Powered</h4>
            <p class="text-xs text-gray-600 mt-1">Groq + Llama 3.3</p>
          </div>
          <div class="glass-effect rounded-xl p-4 text-center feature-card">
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
              <i data-lucide="globe" class="w-6 h-6 text-blue-600"></i>
            </div>
            <h4 class="font-bold text-sm text-gray-800">Multilingual</h4>
            <p class="text-xs text-gray-600 mt-1">English, Hindi, Punjabi</p>
          </div>
          <div class="glass-effect rounded-xl p-4 text-center feature-card">
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2">
              <i data-lucide="mic" class="w-6 h-6 text-green-600"></i>
            </div>
            <h4 class="font-bold text-sm text-gray-800">Voice Input</h4>
            <p class="text-xs text-gray-600 mt-1">Speak naturally</p>
          </div>
          <div class="glass-effect rounded-xl p-4 text-center feature-card">
            <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-2">
              <i data-lucide="database" class="w-6 h-6 text-pink-600"></i>
            </div>
            <h4 class="font-bold text-sm text-gray-800">70+ Sections</h4>
            <p class="text-xs text-gray-600 mt-1">Searchable database</p>
          </div>
        </div>

      </div>

    </div>

  </div>

  <!-- Response Modal -->
  <div id="responseModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="glass-effect rounded-3xl shadow-2xl max-w-4xl w-full mx-4 fade-in max-h-[90vh] overflow-hidden flex flex-col">
      <div class="flex justify-between items-center border-b border-gray-200 px-6 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white">
        <h2 class="text-xl font-bold flex items-center gap-2">
          <i data-lucide="message-circle" class="w-6 h-6"></i> 
          LawBot Response
        </h2>
        <button onclick="closeModal()" class="hover:bg-white/20 p-2 rounded-lg transition">
          <i data-lucide="x" class="w-6 h-6"></i>
        </button>
      </div>
      <div class="overflow-y-auto p-6 flex-1">
        <div class="mb-4">
          <p class="font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <i data-lucide="help-circle" class="w-4 h-4"></i> Your Question:
          </p>
          <div class="bg-purple-50 rounded-lg p-3">
            <pre id="modalQuestion" class="whitespace-pre-wrap text-gray-800 text-sm"></pre>
          </div>
        </div>
        <div>
          <p class="font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <i data-lucide="sparkles" class="w-4 h-4"></i> AI Answer:
          </p>
          <div class="bg-blue-50 rounded-lg p-4">
            <div id="modalAnswer" class="prose prose-sm max-w-none"></div>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-200 p-4 flex justify-end gap-3 bg-gray-50">
        <button onclick="copyAnswer()" class="flex items-center gap-2 px-5 py-2 border-2 border-purple-600 text-purple-600 rounded-xl hover:bg-purple-50 transition font-semibold">
          <i data-lucide="copy" class="w-4 h-4"></i> Copy Answer
        </button>
        <button onclick="closeModal()" class="flex items-center gap-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-5 py-2 rounded-xl hover:shadow-lg transition font-semibold">
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-center text-white text-sm mt-8 pb-4">
    <p class="mb-2"><strong>Disclaimer:</strong> AI-generated responses. Verify through official sources.</p>
    <p>Designed by <strong>NIC, Kurukshetra</strong> for <strong>District Administration, Kurukshetra</strong></p>
    <p class="text-xs mt-2 opacity-75">Last Modified: <span id="lastModified"></span></p>
  </footer>

  <script>
    document.getElementById("lastModified").textContent = new Date(document.lastModified).toLocaleString();
    lucide.createIcons();

    const WEBHOOK_URL = 'https://n8n-workflow-test.duckdns.org/webhook/chatbot';

    // Ready-made questions database
    const QUESTIONS = [
      "What are the three new prosecution laws implemented since 2024?",
      "How have the new laws changed the FIR process?",
      "Are bail provisions modified under the new system?",
      "How are cybercrimes treated under the new prosecution laws?",
      "What changes exist in the evidence collection process?",
      "Do victims get more rights or faster justice now?",
      "Are new offences introduced or penalties enhanced?",
      "How do the new laws ensure speedy trials?",
      "Do these laws affect existing criminal cases?",
      "Any changes to police powers or arrest procedures?",
      "What about reforms in case hearings and appeals?",
      "How are economic crimes handled differently?",
      "Do these laws simplify court processes?",
      "Is digital submission of evidence allowed now?",
      "What are the main benefits for citizens?",
      "How do these laws support fair prosecution?",
      "Are there any guidelines for prosecutors?",
      "What are the penalties for delaying investigation?",
      "How can I access the official text of the laws?",
      "Do these laws align with constitutional rights?",
      "What is the difference between BNS, BNSS and BSA?",
      "How to file an FIR under new laws?",
      "What are cognizable and non-cognizable offences?",
      "Can I get anticipatory bail under new laws?",
      "What is community service as punishment?"
    ];

    // Render ready questions
    function renderReadyQuestions() {
      const container = document.getElementById('readyQuestions');
      QUESTIONS.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'bg-gradient-to-r from-purple-50 to-pink-50 p-3 rounded-lg cursor-pointer hover:shadow-md transition border border-purple-100';
        div.onclick = () => selectQuestion(q);
        div.innerHTML = `
          <p class="text-xs font-medium text-gray-800 line-clamp-2">${q}</p>
        `;
        container.appendChild(div);
      });
    }

    function selectQuestion(q) {
      document.getElementById('questionInput').value = q;
      updateCharCount();
      hideAutocomplete();
    }

    // Autocomplete functionality
    function showAutocomplete() {
      const input = document.getElementById('questionInput').value.toLowerCase();
      const dropdown = document.getElementById('autocompleteDropdown');
      
      if (input.length < 2) {
        hideAutocomplete();
        return;
      }

      const matches = QUESTIONS.filter(q => q.toLowerCase().includes(input)).slice(0, 8);
      
      if (matches.length === 0) {
        hideAutocomplete();
        return;
      }

      dropdown.innerHTML = matches.map(q => `
        <div class="autocomplete-item px-4 py-3 cursor-pointer border-b border-gray-100 last:border-0" onclick="selectQuestion('${q.replace(/'/g, "\\'")}')">
          <p class="text-sm text-gray-800">${q}</p>
        </div>
      `).join('');
      
      dropdown.classList.remove('hidden');
    }

    function hideAutocomplete() {
      document.getElementById('autocompleteDropdown').classList.add('hidden');
    }

    // Character count
    document.getElementById('questionInput').addEventListener('input', updateCharCount);
    function updateCharCount() {
      const input = document.getElementById('questionInput');
      const count = input.value.length;
      document.getElementById('charCount').textContent = `${count} / 500 characters`;
      if (count > 500) {
        input.value = input.value.substring(0, 500);
      }
    }

    // Get selected language
    function getSelectedLanguage() {
      return document.querySelector('input[name="language"]:checked').value;
    }

    // Voice Input
    let recognition;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('questionInput').value = transcript;
        updateCharCount();
        updateVoiceButton('mic', 'Speak Your Question');
      };

      recognition.onerror = (event) => {
        console.error('Voice error:', event.error);
        updateVoiceButton('mic', 'Speak Your Question');
      };

      recognition.onend = () => {
        updateVoiceButton('mic', 'Speak Your Question');
      };
    }

    function updateVoiceButton(icon, text) {
      document.getElementById('voiceBtn').innerHTML = `<i data-lucide="${icon}" class="w-5 h-5"></i><span>${text}</span>`;
      lucide.createIcons();
    }

    document.getElementById('voiceBtn').addEventListener('click', () => {
      if (!recognition) {
        alert('Voice input not supported. Try Chrome or Edge.');
        return;
      }

      const langMap = { 'English': 'en-IN', 'Hindi': 'hi-IN', 'Punjabi': 'pa-IN' };
      recognition.lang = langMap[getSelectedLanguage()] || 'en-IN';

      updateVoiceButton('mic-off', 'Listening...');
      document.getElementById('statusText').textContent = 'Listening... Speak now';

      try {
        recognition.start();
      } catch (err) {
        console.error('Voice error:', err);
        updateVoiceButton('mic', 'Speak Your Question');
      }
    });

    // Ask Button
    document.getElementById('askBtn').addEventListener('click', async () => {
      const name = document.getElementById('userName').value.trim() || 'Visitor';
      const question = document.getElementById('questionInput').value.trim();
      const language = getSelectedLanguage();

      if (!question) {
        alert('Please enter a question');
        return;
      }

      const askBtn = document.getElementById('askBtn');
      askBtn.disabled = true;
      askBtn.innerHTML = '<i data-lucide="loader" class="w-5 h-5 animate-spin"></i><span>Processing...</span>';
      lucide.createIcons();
      document.getElementById('statusText').textContent = 'Getting AI response...';

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, question, language })
        });

        let answerText = '';
        if (res.ok) {
          const data = await res.json();
          answerText = data.answer || data.error || "No answer received.";
        } else {
          answerText = `Error: ${res.status} ${res.statusText}`;
        }

        answerText = processAnswer(answerText);
        
        document.getElementById('modalQuestion').textContent = question;
        document.getElementById('modalAnswer').innerHTML = answerText;
        openModal();

      } catch (err) {
        alert('Connection failed: ' + err.message);
      } finally {
        askBtn.disabled = false;
        askBtn.innerHTML = '<i data-lucide="send" class="w-5 h-5"></i><span>Ask LawBot</span>';
        lucide.createIcons();
        document.getElementById('statusText').textContent = '';
      }
    });

    function processAnswer(text) {
      // Process section references and formatting
      text = text.replace(/\n/g, '<br>');
      return text;
    }

    function openModal() {
      document.getElementById('responseModal').classList.remove('hidden');
      lucide.createIcons();
    }

    function closeModal() {
      document.getElementById('responseModal').classList.add('hidden');
    }

    function copyAnswer() {
      const answerDiv = document.getElementById('modalAnswer');
      const textContent = answerDiv.innerText || answerDiv.textContent;
      navigator.clipboard.writeText(textContent);
      alert('Answer copied to clipboard!');
    }

    // Initialize
    renderReadyQuestions();
    document.addEventListener('click', (e) => {
      if (!e.target.closest('#questionInput') && !e.target.closest('#autocompleteDropdown')) {
        hideAutocomplete();
      }
    });
  </script>
</body>
</html>
