<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LawBot 2024 ‚Äì New Criminal Laws Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: radial-gradient(ellipse at top, #1e3a8a, #0f172a);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(249, 115, 22, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }
    
    .playfair { font-family: 'Playfair Display', serif; }
    .container-main { position: relative; z-index: 1; }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #ff6b35 0%, #f59e0b 50%, #ff6b35 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% auto;
      animation: shimmer 3s linear infinite;
    }
    
    @keyframes shimmer { to { background-position: 200% center; } }
    
    .header-glow { position: relative; }
    .header-glow::before {
      content: '';
      position: absolute;
      top: -20px; left: 50%;
      transform: translateX(-50%);
      width: 200px; height: 200px;
      background: radial-gradient(circle, rgba(251, 191, 36, 0.3), transparent 70%);
      filter: blur(40px);
      pointer-events: none;
    }
    
    .fade-in { animation: fadeIn 0.8s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
      }
      50% { 
        transform: scale(1.02);
        box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
      }
    }
    
    .query-type-selector {
      background: linear-gradient(135deg, #fef3c7, #fed7aa);
      border: 3px solid #f59e0b;
      border-radius: 16px;
      padding: 16px 12px;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
    }
    
    .radio-option {
      position: relative;
      display: flex;
      align-items: flex-start;
      padding: 10px 12px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 10px;
      min-height: 55px;
    }
    
    .radio-option:hover {
      border-color: #f59e0b;
      transform: translateX(3px);
      box-shadow: 0 3px 12px rgba(245, 158, 11, 0.2);
    }
    
    .radio-option.selected {
      border-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
      transform: scale(1.01);
    }
    
    .radio-option input[type="radio"] {
      width: 18px; height: 18px;
      margin-right: 10px;
      cursor: pointer;
      accent-color: #f59e0b;
      flex-shrink: 0;
    }
    
    .radio-icon { font-size: 20px; margin-right: 8px; flex-shrink: 0; }
    .radio-label {
      flex: 1;
    }
    .radio-label-title {
      font-size: 13px;
      font-weight: 700;
      color: #1f2937;
      line-height: 1.2;
    }
    .radio-label-desc {
      font-size: 10px;
      color: #6b7280;
      line-height: 1.3;
      margin-top: 2px;
    }
    
    .user-card {
      padding: 12px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      min-height: 90px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .user-card:hover {
      border-color: #f59e0b;
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
    }
    
    .user-card.selected {
      border-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
      transform: scale(1.03);
    }
    
    .user-icon { font-size: 32px; margin-bottom: 6px; }
    .user-title {
      font-size: 13px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 2px;
      line-height: 1.2;
    }
    .user-desc {
      font-size: 9px;
      color: #6b7280;
      line-height: 1.2;
    }
    
    .user-card-small {
      padding: 10px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      min-height: 85px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .user-card-small:hover {
      border-color: #3b82f6;
      transform: translateY(-3px);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
    }
    
    .user-card-small.selected {
      border-color: #3b82f6;
      background: linear-gradient(135deg, #dbeafe, #bfdbfe);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
      transform: scale(1.02);
    }
    
    .user-icon-small { font-size: 28px; margin-bottom: 4px; }
    .user-title-small {
      font-size: 12px;
      font-weight: 700;
      color: #1f2937;
      line-height: 1.2;
    }
    .user-desc-small {
      font-size: 9px;
      color: #6b7280;
      line-height: 1.2;
      margin-top: 2px;
    }
    
    .topic-card {
      padding: 10px 14px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .topic-card:hover {
      border-color: #3b82f6;
      transform: translateX(4px);
      box-shadow: 0 4px 14px rgba(59, 130, 246, 0.2);
    }
    
    .topic-card.selected {
      border-color: #3b82f6;
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
    }
    
    .topic-icon { font-size: 22px; flex-shrink: 0; }
    .topic-title {
      font-size: 13px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 1px;
      line-height: 1.2;
    }
    .topic-subtitle {
      font-size: 9px;
      color: #6b7280;
      line-height: 1.2;
    }
    .topic-law {
      font-size: 9px;
      color: #3b82f6;
      font-weight: 600;
      margin-top: 1px;
    }
    
    .mic-btn { transition: all 0.3s; }
    .mic-btn.recording {
      background: linear-gradient(135deg, #dc2626, #ef4444) !important;
      animation: pulseRec 1.5s ease-in-out infinite;
    }
    
    @keyframes pulseRec {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #ff6b35, #f59e0b);
      color: white;
      font-weight: 700;
      padding: 18px 32px;
      border-radius: 16px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(255, 107, 53, 0.5);
    }
    
    .ai-try-btn {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      min-width: 100px;
    }
    
    .ai-try-btn:hover {
      border-color: #8b5cf6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
    }
    
    .ai-try-btn.active {
      border-color: #8b5cf6;
      background: linear-gradient(135deg, #faf5ff, #f3e8ff);
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
      transform: scale(1.05);
    }
    
    .ai-try-btn.used {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: #d1d5db;
      background: #f3f4f6;
    }
    
    .ai-try-btn:disabled {
      cursor: not-allowed;
    }
    
    .ai-try-btn-compact {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 70px;
    }
    
    .ai-try-btn-compact:hover {
      border-color: #8b5cf6;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
    }
    
    .ai-try-btn-compact.active {
      border-color: #8b5cf6;
      background: linear-gradient(135deg, #faf5ff, #f3e8ff);
      box-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
    }
    
    .answer-level-btn {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 80px;
    }
    
    .answer-level-btn:hover {
      border-color: #f59e0b;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
    }
    
    .answer-level-btn.active {
      border-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      box-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
      font-weight: 700;
    }
    
    .compact-dropdown {
      padding: 6px 32px 6px 10px;
      border: 2px solid #d1d5db;
      border-radius: 8px;
      background: white;
      font-size: 13px;
      font-weight: 600;
      color: #1f2937;
      cursor: pointer;
      transition: all 0.3s;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      min-width: 130px;
    }
    
    .compact-dropdown:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }
    
    .compact-dropdown:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .icon-btn {
      padding: 8px;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }
    
    .icon-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    @media (max-width: 768px) {
      .header-glow { padding: 12px 16px 8px !important; }
      .header-glow h1 { font-size: 2.5rem !important; }
      .user-card { min-height: 85px; padding: 10px; }
      .user-icon { font-size: 28px; margin-bottom: 4px; }
      .user-title { font-size: 12px; }
      .user-desc { font-size: 8px; }
      .topic-card { padding: 8px 12px; }
      .topic-icon { font-size: 20px; }
      .topic-title { font-size: 12px; }
      .radio-option { min-height: 50px; padding: 8px 10px; }
      .radio-icon { font-size: 18px; }
    }
    
    /* Tablet and larger - optimize topic cards for 2-3 columns */
    @media (min-width: 640px) and (max-width: 1023px) {
      .topic-card { padding: 10px 12px; }
      .topic-title { font-size: 12px; }
      .topic-subtitle { font-size: 9px; }
    }
    
    /* Desktop - optimize for 3 column layout */
    @media (min-width: 1024px) {
      .topic-card { 
        padding: 10px 14px;
        min-height: 70px;
      }
      .user-card {
        min-height: 95px;
      }
    }
    
    /* Large desktop - more comfortable spacing */
    @media (min-width: 1280px) {
      .topic-card { 
        padding: 12px 16px;
        min-height: 75px;
      }
      .user-card {
        min-height: 100px;
        padding: 14px;
      }
      .user-icon { font-size: 36px; }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

  <div class="container-main w-full max-w-5xl glass-card rounded-3xl shadow-2xl overflow-hidden">
    
    <div class="relative bg-gradient-to-br from-orange-50 via-amber-50 to-yellow-50 p-6 pb-4 text-center header-glow">
      <div class="floating">
        <h1 class="text-5xl md:text-6xl font-black gradient-text mb-2 playfair tracking-tight">
          LawBot 2024
        </h1>
      </div>
      <p class="text-sm text-gray-600 font-semibold mb-3 tracking-wide">
        Your AI Assistant for New Criminal Laws
      </p>
      
      <div class="w-full max-w-2xl mx-auto px-4">
        <div class="bg-white rounded-2xl border-3 border-orange-400 py-2 px-4 shadow-xl">
          <h2 class="text-xs sm:text-sm font-black text-center bg-gradient-to-r from-orange-600 to-amber-600 bg-clip-text text-transparent leading-tight">
            Bharatiya Nyaya Sanhita ‚Ä¢ Bharatiya Nagarik Suraksha Sanhita ‚Ä¢ Bharatiya Sakshya Adhiniyam
          </h2>
        </div>
      </div>
    </div>

    <div class="p-2">
      
      <!-- ALWAYS VISIBLE: Who are you? -->
      <div class="mb-4">
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-2xl p-4" id="profileSelector">
          <label class="block text-base font-bold text-gray-800 mb-3 flex items-center gap-2">
            <span class="bg-blue-600 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold">üë§</span>
            Who are you?
            <span class="text-xs font-normal text-gray-600">(Default: General Citizen - Change if needed)</span>
          </label>
          
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
            <div class="user-card-small" id="userPoliceMain" onclick="selectMainUser('police')">
              <div class="user-icon-small">üëÆ</div>
              <div class="user-title-small">Police Officer</div>
              <div class="user-desc-small">Investigation, FIR, Procedures</div>
            </div>
            
            <div class="user-card-small" id="userLegalMain" onclick="selectMainUser('legal')">
              <div class="user-icon-small">‚öñÔ∏è</div>
              <div class="user-title-small">Legal Professional</div>
              <div class="user-desc-small">Lawyers, Judges, Prosecutors</div>
            </div>
            
            <div class="user-card-small" id="userStudentMain" onclick="selectMainUser('student')">
              <div class="user-icon-small">üë®‚Äçüéì</div>
              <div class="user-title-small">Student/Researcher</div>
              <div class="user-desc-small">Law students, Academics</div>
            </div>
            
            <div class="user-card-small" id="userCitizenMain" onclick="selectMainUser('citizen')">
              <div class="user-icon-small">üßë‚Äçüíº</div>
              <div class="user-title-small">General Citizen</div>
              <div class="user-desc-small">Rights, Complaints, Info</div>
            </div>
          </div>
          
          <p class="text-xs text-blue-700 mt-2 text-center italic font-semibold" id="profileHint">
            ‚úì Default: General Citizen (You can change this above)
          </p>
        </div>
      </div>
      
      <div class="query-type-selector">
        <h3 class="text-xl font-bold text-gray-900 mb-4 text-center flex items-center justify-center gap-2">
          <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          What would you like to know?
        </h3>
        
        <div class="radio-option selected" id="customCard" onclick="selectQueryType('custom')">
          <input type="radio" name="queryType" value="custom" checked>
          <span class="radio-icon">‚úèÔ∏è</span>
          <div class="radio-label">
            <div class="radio-label-title">Ask Your Own Question</div>
            <div class="radio-label-desc">Type any question about criminal laws</div>
          </div>
        </div>
        
        <div class="radio-option" id="readyCard" onclick="selectQueryType('ready')">
          <input type="radio" name="queryType" value="ready">
          <span class="radio-icon">üìã</span>
          <div class="radio-label">
            <div class="radio-label-title">Select Ready-Made Question</div>
            <div class="radio-label-desc">Choose by your profile and topic</div>
          </div>
        </div>
      </div>

      <div id="questionSection">
        
        <!-- CUSTOM QUESTION DIV -->
        <div id="customQuestionDiv" class="mb-8 fade-in">
          <div class="relative">
            <textarea
              id="userInput"
              rows="3"
              class="w-full rounded-2xl border-4 border-orange-400 p-4 pb-12 text-gray-900 bg-gradient-to-br from-white to-orange-50 shadow-2xl resize-none focus:border-orange-500 focus:ring-4 focus:ring-orange-200 transition-all duration-300"
              placeholder="Type your question here... (e.g., What are my rights during arrest?)"
            ></textarea>
            <button
              id="voiceBtn"
              class="mic-btn absolute bottom-3 right-3 text-orange-500 hover:text-orange-700 transition-all bg-white rounded-full p-3 shadow-lg border-2 border-orange-300"
              title="Click to speak"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- READY QUESTIONS DIV -->
        <div id="readyQuestionDiv" style="display: none;" class="mb-8 fade-in">
          
          <!-- Step 1: WHAT TOPIC? (Profile already selected at top) -->
          <div class="mb-6" id="topicSection" style="display: none;">
            <label class="block text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
              <span class="bg-orange-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold">1</span>
              üìö What do you want to know about?
            </label>
            <p class="text-xs text-gray-600 mb-4 ml-10">Choose a topic - we'll find the right law for you</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2" id="topicContainer">
              <!-- Topics will load here dynamically -->
            </div>
          </div>
          
          <!-- Step 2: SELECT YOUR QUESTION -->
          <div class="mb-6" id="questionSelectSection" style="display: none;">
            <label class="block text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
              <span class="bg-orange-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold">2</span>
              ‚ùì Select Your Question
            </label>
            
            <select id="questionSelect" class="block w-full px-5 py-4 text-base border-3 border-orange-400 focus:ring-4 focus:ring-orange-200 rounded-2xl bg-gradient-to-br from-white to-orange-50 shadow-lg transition-all font-medium mb-4">
              <option value="" selected disabled>Select a question...</option>
            </select>
          </div>
          
        </div>

        <button 
          id="submitBtn" 
          class="w-full btn-primary flex items-center justify-center gap-3 text-xl fade-in"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          Get Answer
        </button>

      </div>

    </div>

    <div class="border-t-2 border-gray-200 px-6 py-4 text-center bg-gradient-to-b from-gray-50 to-white">
      <p class="text-sm text-gray-700 mb-2 font-medium">
        AI Chatbot powered by <span class="font-bold text-orange-600">Groq + Llama 3.3</span>
      </p>
      <p class="text-gray-500 text-xs mb-3">
        Designed by <strong>NIC, Kurukshetra</strong> for <strong>District Administration, Kurukshetra</strong>
      </p>
      <p class="text-xs text-gray-600 font-semibold">
        Last Modified: <span id="lastModified" class="text-orange-700 font-bold">Loading...</span>
      </p>
    </div>

  </div>

  <!-- FIXED MODAL WITH PROPER HEIGHT MANAGEMENT -->
  <div id="aiModal" class="hidden fixed inset-0 flex items-center justify-center p-2" style="z-index: 9999; background: rgba(0,0,0,0.92);">
    <div class="bg-white rounded-3xl shadow-2xl w-full mx-2 flex flex-col" style="max-width: 850px; max-height: 90vh;">
      
      <!-- Header - Fixed -->
      <div class="flex justify-between items-center px-5 py-4 bg-gradient-to-r from-blue-600 to-indigo-700 text-white flex-shrink-0">
        <h2 class="text-xl font-bold flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
          LawBot Response
        </h2>
        <button id="closeModal" class="hover:bg-white/20 p-2 rounded-full transition">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Scrollable Content Area -->
      <div class="p-5 overflow-y-auto bg-gray-50 flex-1" style="min-height: 0;">
        <div class="mb-5">
          <p class="font-bold text-gray-900 mb-2">Question:</p>
          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-2xl border-l-4 border-blue-500">
            <pre id="modalQuestion" class="whitespace-pre-wrap text-gray-800"></pre>
          </div>
        </div>

        <div>
          <p class="font-bold text-gray-900 mb-2">Answer:</p>
          <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-4 rounded-2xl border-l-4 border-orange-500">
            <pre id="modalAnswer" class="whitespace-pre-wrap text-gray-800 text-sm leading-loose"></pre>
          </div>
        </div>
      </div>

      <!-- Ultra-Compact Footer - Single Row with Dropdowns -->
      <div class="border-t-2 border-gray-200 bg-white flex-shrink-0">
        <div class="px-4 py-3 flex items-center justify-between gap-3 flex-wrap">
          
          <!-- Left side: Dropdowns -->
          <div class="flex items-center gap-3 flex-wrap">
            <!-- Answer Depth Dropdown -->
            <div class="flex items-center gap-2">
              <label class="text-xs font-bold text-gray-700 whitespace-nowrap">üìä Depth:</label>
              <select id="depthSelector" class="compact-dropdown" onchange="changeAnswerLevel(this.value)">
                <option value="brief">üìù Brief</option>
                <option value="standard" selected>üìÑ Standard</option>
                <option value="detailed">üìö Detailed</option>
              </select>
            </div>
            
            <!-- AI Engine Dropdown -->
            <div class="flex items-center gap-2">
              <label class="text-xs font-bold text-gray-700 whitespace-nowrap">ü§ñ AI:</label>
              <select id="aiSelector" class="compact-dropdown" onchange="retryWithAI(this.value)">
                <option value="groq" selected>üöÄ Groq</option>
                <option value="gemini">üíé Gemini</option>
                <option value="chatgpt">ü§ñ ChatGPT</option>
              </select>
            </div>
          </div>
          
          <!-- Right side: Action Buttons -->
          <div class="flex items-center gap-2">
            <button onclick="shareOnWhatsApp()" class="icon-btn bg-green-600 hover:bg-green-700" title="Share on WhatsApp">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
            </button>
            
            <button onclick="openSectionSearch()" class="icon-btn bg-blue-600 hover:bg-blue-700" title="Search Exact Section">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </button>
            
            <button id="closeBtn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition font-semibold text-sm">
              Close
            </button>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <script>
    console.log('üöÄ LawBot 2024 initializing...');
    
    // Update Last Modified DateTime - AUTOMATIC DETECTION
    function updateLastModified() {
      try {
        // Get document's actual last modified date
        let lastModDate;
        
        if (document.lastModified) {
          // Parse the document.lastModified string
          lastModDate = new Date(document.lastModified);
          console.log('üìÖ Document last modified:', document.lastModified);
        } else {
          // Fallback to current date if not available
          lastModDate = new Date();
        }
        
        // Validate date
        if (isNaN(lastModDate.getTime())) {
          lastModDate = new Date();
        }
        
        const day = lastModDate.getDate();
        const suffix = (day) => {
          if (day > 3 && day < 21) return 'th';
          switch (day % 10) {
            case 1: return 'st';
            case 2: return 'nd';
            case 3: return 'rd';
            default: return 'th';
          }
        };
        
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        const month = monthNames[lastModDate.getMonth()];
        const year = lastModDate.getFullYear();
        const hours = lastModDate.getHours().toString().padStart(2, '0');
        const minutes = lastModDate.getMinutes().toString().padStart(2, '0');
        
        const formattedDate = `${day}${suffix(day)} ${month} ${year}, ${hours}:${minutes} IST`;
        
        const element = document.getElementById('lastModified');
        if (element) {
          element.textContent = formattedDate;
          console.log('‚úÖ Last Modified displayed:', formattedDate);
        }
      } catch (error) {
        console.error('‚ùå Last Modified error:', error);
        const element = document.getElementById('lastModified');
        if (element) {
          element.textContent = '15th December 2024, 21:18 IST';
        }
      }
    }
    
    // Call when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', updateLastModified);
    } else {
      updateLastModified();
    }
    
    // Set default profile on page load
    function setDefaultProfile() {
      // Default to General Citizen (most common user type)
      selectMainUser('citizen');
      console.log('‚úÖ Default profile set: General Citizen');
    }
    
    // Initialize default profile when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setDefaultProfile);
    } else {
      setDefaultProfile();
    }
    
    const WEBHOOK_URL = 'https://n8n-workflow-test.duckdns.org/webhook/chatbot';
    
    let currentQuestion = '';
    let currentAI = 'groq';
    let selectedUser = 'citizen'; // Default to General Citizen
    let selectedTopic = '';
    let selectedQueryType = 'custom';
    let aiUsed = {
      groq: false,
      chatgpt: false,
      gemini: false
    };
    
    // User-level specific prompt instructions
    const USER_LEVEL_PROMPTS = {
      police: {
        level: 'intermediate',
        instruction: 'You are answering for a Police Officer. Provide practical, action-oriented answers with clear procedures, legal provisions, and step-by-step guidance. Focus on investigation procedures, FIR handling, arrest protocols, and evidence collection. Use official terminology but keep it practical for field work.',
        tone: 'Professional and procedural'
      },
      legal: {
        level: 'advanced',
        instruction: 'You are answering for a Legal Professional (Lawyer/Judge/Prosecutor). Provide detailed legal analysis with specific section references, case law interpretations, procedural nuances, and technical legal terminology. Include comparative analysis between old and new laws where relevant.',
        tone: 'Technical and analytical'
      },
      student: {
        level: 'educational',
        instruction: 'You are answering for a Law Student/Researcher. Provide comprehensive educational content with clear explanations, examples, conceptual clarity, and academic perspective. Include both theoretical understanding and practical applications. Use structured format with key points.',
        tone: 'Educational and detailed'
      },
      citizen: {
        level: 'basic',
        instruction: 'You are answering for a General Citizen. Provide simple, easy-to-understand explanations in plain language. Focus on practical rights, what to do in common situations, and step-by-step guidance. Avoid complex legal jargon. Use examples and analogies.',
        tone: 'Simple and practical'
      }
    };
    
    // Multi-level answer depth options
    const ANSWER_LEVELS = {
      brief: {
        label: 'üìù Brief',
        instruction: 'Provide a concise answer in 2-3 paragraphs covering only the essential points.',
        icon: 'üìù'
      },
      standard: {
        label: 'üìÑ Standard',
        instruction: 'Provide a comprehensive answer with all important details, examples, and relevant sections.',
        icon: 'üìÑ'
      },
      detailed: {
        label: 'üìö Detailed',
        instruction: 'Provide an in-depth, exhaustive answer covering all aspects, subsections, exceptions, examples, and practical implications.',
        icon: 'üìö'
      }
    };
    
    let currentAnswerLevel = 'standard'; // Default level
    
    // Main answer function with level-based prompts
    async function getAnswer(provider, answerLevel = 'standard') {
      currentAI = provider;
      currentAnswerLevel = answerLevel;
      aiUsed[provider] = true;
      
      const loadingMessages = {
        groq: '‚ö° Groq is processing at lightning speed...',
        chatgpt: 'ü§ñ ChatGPT is analyzing deeply...',
        gemini: 'üíé Gemini is generating balanced response...'
      };
      
      const providerNames = {
        groq: 'üöÄ Groq Llama 3.3',
        chatgpt: 'ü§ñ ChatGPT GPT-4o',
        gemini: 'üíé Gemini Flash 2.0'
      };
      
      document.getElementById('modalQuestion').textContent = currentQuestion;
      document.getElementById('modalAnswer').textContent = loadingMessages[provider];
      document.getElementById('aiModal').classList.remove('hidden');
      
      updateModalHeader(provider);
      updateAIButtons();
      updateAnswerLevelButtons();
      
      const startTime = Date.now();
      
      // Build enhanced prompt with user level and answer depth
      let enhancedPrompt = currentQuestion;
      
      if (selectedUser && USER_LEVEL_PROMPTS[selectedUser]) {
        const userLevel = USER_LEVEL_PROMPTS[selectedUser];
        enhancedPrompt = `[AUDIENCE: ${userLevel.level.toUpperCase()}]\n` +
                        `[INSTRUCTION: ${userLevel.instruction}]\n` +
                        `[TONE: ${userLevel.tone}]\n\n` +
                        `Question: ${currentQuestion}`;
      }
      
      if (ANSWER_LEVELS[answerLevel]) {
        enhancedPrompt += `\n\n[DEPTH: ${ANSWER_LEVELS[answerLevel].instruction}]`;
      }
      
      try {
        const response = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            question: enhancedPrompt,
            originalQuestion: currentQuestion,
            provider: provider,
            userType: selectedUser,
            userLevel: selectedUser ? USER_LEVEL_PROMPTS[selectedUser].level : 'general',
            topic: selectedTopic,
            queryType: selectedQueryType,
            answerDepth: answerLevel,
            timestamp: new Date().toISOString()
          })
        });
        
        if (!response.ok) throw new Error('HTTP ' + response.status);
        
        const data = await response.json();
        let answerText = data.answer || data.response || 'No response';
        answerText = answerText.replace('[SEARCH_BUTTON]', '');
        
        const responseTime = ((Date.now() - startTime) / 1000).toFixed(2);
        
        // Add metadata footer
        const levelEmoji = ANSWER_LEVELS[answerLevel].icon;
        const userTypeLabel = selectedUser ? ` | üë§ ${selectedUser.charAt(0).toUpperCase() + selectedUser.slice(1)}` : '';
        
        document.getElementById('modalAnswer').textContent = answerText + 
          '\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n' +
          `${levelEmoji} ${answerLevel.charAt(0).toUpperCase() + answerLevel.slice(1)} Answer${userTypeLabel}\n` +
          `‚è±Ô∏è Response: ${responseTime}s with ${providerNames[provider]}`;
        
        console.log('‚úÖ Response from', provider, 'in', responseTime, 'seconds');
        
      } catch (error) {
        console.error('‚ùå Error:', error);
        document.getElementById('modalAnswer').textContent = 'Error: Could not connect to ' + provider.toUpperCase() + '. Please try again.';
      }
    }
    
    // Retry with different AI
    function retryWithAI(provider) {
      // Allow switching to any AI at any time
      aiUsed[provider] = true;
      getAnswer(provider, currentAnswerLevel);
    }
    
    window.retryWithAI = retryWithAI;
    
    // Change answer depth level
    function changeAnswerLevel(level) {
      currentAnswerLevel = level;
      
      // Update dropdown selection
      const depthSelector = document.getElementById('depthSelector');
      if (depthSelector) {
        depthSelector.value = level;
      }
      
      getAnswer(currentAI, level);
    }
    
    window.changeAnswerLevel = changeAnswerLevel;
    
    // Update answer level buttons (deprecated - now using dropdown)
    function updateAnswerLevelButtons() {
      const depthSelector = document.getElementById('depthSelector');
      if (depthSelector) {
        depthSelector.value = currentAnswerLevel;
      }
    }
    
    // Update AI button states (now updates dropdown)
    function updateAIButtons() {
      const aiSelector = document.getElementById('aiSelector');
      if (aiSelector) {
        aiSelector.value = currentAI;
      }
    }
    
    // Update Modal Header with AI Provider
    function updateModalHeader(provider) {
      const icons = {
        groq: 'üöÄ',
        chatgpt: 'ü§ñ',
        gemini: 'üíé'
      };
      
      const names = {
        groq: 'Groq Llama 3.3',
        chatgpt: 'ChatGPT GPT-4o',
        gemini: 'Gemini Flash 2.0'
      };
      
      const header = document.querySelector('#aiModal .bg-gradient-to-r h2');
      if (header) {
        header.innerHTML = '<svg class="w-6 h-6 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>' +
          '</svg>' +
          '<span class="ml-2">' + icons[provider] + ' ' + names[provider] + ' Response</span>';
      }
    }
    
    // TOPICS organized by user type
    const TOPICS = {
      police: [
        { id: 'fir', icon: 'üìù', title: 'FIR & Complaints', subtitle: 'Registration, Zero FIR, Refusal', law: 'BNSS' },
        { id: 'arrest', icon: 'üöî', title: 'Arrest & Custody', subtitle: 'Warrant, Remand, Rights', law: 'BNSS' },
        { id: 'investigation', icon: 'üîç', title: 'Investigation', subtitle: 'Evidence, Search, Seizure', law: 'BNSS' },
        { id: 'evidence', icon: 'üìä', title: 'Evidence Handling', subtitle: 'Digital, Chain of custody', law: 'BSA' },
        { id: 'chargesheet', icon: 'üìã', title: 'Charge Sheet', subtitle: 'Filing, Timeline', law: 'BNSS' },
        { id: 'crimes', icon: '‚ö†Ô∏è', title: 'Common Crimes', subtitle: 'Theft, Assault, Cyber', law: 'BNS' },
        { id: 'rights', icon: 'üë•', title: 'Rights of Accused', subtitle: 'During arrest, trial', law: 'BNSS' },
        { id: 'terminology', icon: 'üìö', title: 'Legal Terms', subtitle: 'Cognizable, Bailable', law: 'All' }
      ],
      legal: [
        { id: 'bail', icon: 'üèõÔ∏è', title: 'Bail & Bonds', subtitle: 'Regular, Anticipatory', law: 'BNSS' },
        { id: 'trial', icon: '‚öñÔ∏è', title: 'Trial Process', subtitle: 'Summons, Warrant, Sessions', law: 'BNSS' },
        { id: 'evidence', icon: 'üìä', title: 'Evidence Law', subtitle: 'Admissibility, Electronic', law: 'BSA' },
        { id: 'appeals', icon: 'üìë', title: 'Appeals & Revision', subtitle: 'High Court, Supreme Court', law: 'BNSS' },
        { id: 'punishments', icon: '‚öñÔ∏è', title: 'Punishments', subtitle: 'IPC vs BNS changes', law: 'BNS' },
        { id: 'procedures', icon: 'üìã', title: 'Court Procedures', subtitle: 'Filing, Documentation', law: 'BNSS' },
        { id: 'comparison', icon: 'üîÑ', title: 'Old vs New Laws', subtitle: 'Key changes', law: 'All' },
        { id: 'terminology', icon: 'üìö', title: 'Legal Terminology', subtitle: 'Advanced concepts', law: 'All' }
      ],
      student: [
        { id: 'comparison', icon: 'üîÑ', title: 'Old vs New Laws', subtitle: 'IPC‚ÜíBNS, CrPC‚ÜíBNSS', law: 'All' },
        { id: 'terminology', icon: 'üìö', title: 'Legal Terminology', subtitle: 'All important terms', law: 'All' },
        { id: 'concepts', icon: 'üí°', title: 'Key Concepts', subtitle: 'Mens rea, Actus reus', law: 'BNS' },
        { id: 'criminal', icon: '‚ö†Ô∏è', title: 'Criminal Offences', subtitle: 'Classification, Types', law: 'BNS' },
        { id: 'procedure', icon: 'üìã', title: 'Criminal Procedure', subtitle: 'FIR to Judgment', law: 'BNSS' },
        { id: 'evidence_law', icon: 'üìä', title: 'Evidence Law', subtitle: 'Types, Admissibility', law: 'BSA' },
        { id: 'amendments', icon: 'üìù', title: 'Key Amendments', subtitle: 'Major changes 2024', law: 'All' },
        { id: 'casestudies', icon: 'üìñ', title: 'Examples', subtitle: 'Real-world scenarios', law: 'All' }
      ],
      citizen: [
        { id: 'rights', icon: 'üë•', title: 'Your Rights', subtitle: 'Arrest, trial, investigation', law: 'BNSS' },
        { id: 'complaint', icon: 'üìù', title: 'How to Complain', subtitle: 'FIR, Online complaint', law: 'BNSS' },
        { id: 'bail', icon: 'üèõÔ∏è', title: 'Bail & Release', subtitle: 'How to get bail', law: 'BNSS' },
        { id: 'common', icon: '‚ùì', title: 'Common Situations', subtitle: 'Theft, Accident, Dispute', law: 'BNS' },
        { id: 'legal_aid', icon: '‚öñÔ∏è', title: 'Legal Help', subtitle: 'Free legal aid', law: 'All' },
        { id: 'cybercrime', icon: 'üíª', title: 'Cyber Crimes', subtitle: 'Fraud, Harassment', law: 'BNS' },
        { id: 'women', icon: 'üë©', title: 'Women & Children', subtitle: 'Protection laws', law: 'BNS' },
        { id: 'basics', icon: 'üìö', title: 'Basic Terms', subtitle: 'Simple explanations', law: 'All' }
      ]
    };
    
    // Sample questions for each topic
    const TOPIC_QUESTIONS = {
      fir: ['How to register an FIR?', 'What is Zero FIR?', 'When can police refuse FIR?', 'FIR vs Complaint difference?', 'Online FIR filing process?'],
      arrest: ['When can police arrest without warrant?', 'What is police custody vs judicial custody?', 'Rights of arrested person?', 'Medical examination during arrest?', 'Arrest procedures for women?'],
      investigation: ['What are investigation powers?', 'Search and seizure rules?', 'Chain of custody importance?', 'Timeline for investigation?', 'Rights during investigation?'],
      evidence: ['How to collect digital evidence?', 'Evidence preservation rules?', 'Chain of custody requirements?', 'Electronic evidence admissibility?', 'Evidence tampering consequences?'],
      chargesheet: ['How to file charge sheet?', 'Timeline for filing charge sheet?', 'What documents required?', 'Charge sheet vs FIR difference?', 'Can charge sheet be challenged?'],
      crimes: ['What is theft under BNS?', 'How is assault defined?', 'Cybercrime reporting process?', 'Difference between theft and robbery?', 'Fraud vs cheating definition?'],
      rights: ['What are my rights during arrest?', 'Can I refuse to give statement?', 'Right to lawyer when?', 'Rights during interrogation?', 'What if rights violated?'],
      bail: ['How to apply for bail?', 'Regular bail vs anticipatory bail?', 'What are bail conditions?', 'Bail amount calculation?', 'When can bail be cancelled?'],
      trial: ['Summons case vs warrant case?', 'Trial procedure steps?', 'How long does trial take?', 'Rights during trial?', 'Can trial be fast-tracked?'],
      appeals: ['How to file appeal?', 'Appeal time limits?', 'High Court vs Supreme Court appeals?', 'Appeal procedure steps?', 'Cost of filing appeal?'],
      punishments: ['What changed from IPC to BNS?', 'Punishment for theft?', 'Sentencing guidelines?', 'Mitigating factors in sentencing?', 'Maximum punishment for murder?'],
      procedures: ['How to file case?', 'Court documentation required?', 'Timeline for hearings?', 'Court fees structure?', 'How to get court orders?'],
      comparison: ['Key changes IPC to BNS?', 'BNSS vs CrPC differences?', 'BSA vs Evidence Act changes?', 'Why were laws changed?', 'Implementation timeline?'],
      terminology: ['What is cognizable offence?', 'Define bailable offence?', 'What is mens rea?', 'Explain actus reus?', 'What is compounding?'],
      concepts: ['Explain criminal liability?', 'What is actus reus?', 'Right of private defence?', 'General exceptions concept?', 'Vicarious liability meaning?'],
      criminal: ['Classification of offences?', 'Types of crimes?', 'Punishment categories?', 'Cognizable vs non-cognizable?', 'Bailable vs non-bailable?'],
      procedure: ['From FIR to judgment process?', 'Investigation timeline?', 'Trial stages?', 'Appeal process steps?', 'Entire criminal procedure overview?'],
      evidence_law: ['Types of evidence?', 'Admissibility rules?', 'Burden of proof?', 'Electronic evidence rules?', 'Witness testimony validity?'],
      amendments: ['Major changes in 2024?', 'Why laws changed?', 'Impact of new laws?', 'Transitional provisions?', 'What stayed same?'],
      casestudies: ['Real-world examples?', 'Case studies?', 'Practical scenarios?', 'Application of laws?', 'Common situations explained?'],
      complaint: ['How to file FIR?', 'Online complaint process?', 'What if police refuse?', 'NCW complaint process?', 'Consumer court complaint?'],
      common: ['What to do if theft?', 'Accident procedure?', 'Property dispute resolution?', 'Neighbor dispute handling?', 'Cheque bounce remedy?'],
      legal_aid: ['How to get free legal aid?', 'Legal help resources?', 'Helpline numbers?', 'Government legal services?', 'NGOs for legal help?'],
      cybercrime: ['How to report online fraud?', 'Cyber harassment complaint?', 'Online safety tips?', 'Social media crime reporting?', 'Digital evidence collection?'],
      women: ['Women protection laws?', 'Child protection provisions?', 'Emergency helplines?', 'Domestic violence remedy?', 'Sexual harassment complaint?'],
      basics: ['Basic legal terms?', 'Simple explanations?', 'Common legal words?', 'Court terminology?', 'Legal process basics?']
    };
    
    // FIXED: Proper radio button handling
    function selectQueryType(type) {
      selectedQueryType = type;
      
      const customCard = document.getElementById('customCard');
      const readyCard = document.getElementById('readyCard');
      const customDiv = document.getElementById('customQuestionDiv');
      const readyDiv = document.getElementById('readyQuestionDiv');
      
      // Remove selected class from both
      customCard.classList.remove('selected');
      readyCard.classList.remove('selected');
      
      if (type === 'custom') {
        customCard.classList.add('selected');
        document.querySelector('input[value="custom"]').checked = true;
        customDiv.style.display = 'block';
        readyDiv.style.display = 'none';
      } else {
        readyCard.classList.add('selected');
        document.querySelector('input[value="ready"]').checked = true;
        customDiv.style.display = 'none';
        readyDiv.style.display = 'block';
        
        // IMPORTANT: If profile already selected, show topics immediately
        if (selectedUser) {
          loadTopics(selectedUser);
          document.getElementById('topicSection').style.display = 'block';
          console.log('‚úÖ Topics loaded for already-selected user:', selectedUser);
        } else {
          // Hide topics until profile is selected
          document.getElementById('topicSection').style.display = 'none';
          console.log('‚ö†Ô∏è No profile selected yet - topics hidden');
        }
      }
      
      console.log('‚úÖ Query type selected:', type);
    }
    
    window.selectQueryType = selectQueryType;

    // Select main user profile (always visible)
    function selectMainUser(userType) {
      selectedUser = userType;
      
      // Update main profile cards
      document.querySelectorAll('.user-card-small').forEach(el => el.classList.remove('selected'));
      const mainCard = document.getElementById('user' + userType.charAt(0).toUpperCase() + userType.slice(1) + 'Main');
      if (mainCard) mainCard.classList.add('selected');
      
      // Update hint text
      const userNames = {
        police: 'Police Officer - Get practical, procedural answers',
        legal: 'Legal Professional - Get detailed technical analysis',
        student: 'Student/Researcher - Get educational explanations',
        citizen: 'General Citizen - Get simple, practical guidance'
      };
      
      document.getElementById('profileHint').textContent = '‚úì Selected: ' + userNames[userType];
      
      // If ready-made questions section is visible, load topics automatically
      const readyDiv = document.getElementById('readyQuestionDiv');
      if (readyDiv && readyDiv.style.display !== 'none') {
        loadTopics(userType);
        document.getElementById('topicSection').style.display = 'block';
      }
      
      console.log('‚úÖ Main user profile selected:', userType);
    }
    
    window.selectMainUser = selectMainUser;

    function selectUser(userType) {
      // This function is now deprecated - selectMainUser handles everything
      selectMainUser(userType);
    }
    
    window.selectUser = selectUser;

    function loadTopics(userType) {
      const container = document.getElementById('topicContainer');
      container.innerHTML = '';
      
      const topics = TOPICS[userType] || [];
      
      topics.forEach(function(topic) {
        const topicCard = document.createElement('div');
        topicCard.className = 'topic-card';
        topicCard.id = 'topic-' + topic.id;
        topicCard.onclick = function() { selectTopic(topic.id); };
        
        topicCard.innerHTML = '<div class="topic-icon">' + topic.icon + '</div>' +
          '<div class="flex-1">' +
          '<div class="topic-title">' + topic.title + '</div>' +
          '<div class="topic-subtitle">' + topic.subtitle + '</div>' +
          '<div class="topic-law">' + topic.law + '</div>' +
          '</div>';
        
        container.appendChild(topicCard);
      });
    }

    function selectTopic(topicId) {
      selectedTopic = topicId;
      
      // Update UI
      document.querySelectorAll('.topic-card').forEach(function(el) {
        el.classList.remove('selected');
      });
      const topicCard = document.getElementById('topic-' + topicId);
      if (topicCard) topicCard.classList.add('selected');
      
      // Load questions for this topic
      loadQuestionsForTopic(topicId);
      
      // Show question section
      document.getElementById('questionSelectSection').style.display = 'block';
      
      console.log('‚úÖ Topic selected:', topicId);
    }

    function loadQuestionsForTopic(topicId) {
      const questionSelect = document.getElementById('questionSelect');
      questionSelect.innerHTML = '<option value="" selected disabled>Select a question...</option>';
      
      const questions = TOPIC_QUESTIONS[topicId] || [];
      
      questions.forEach(function(q) {
        const option = document.createElement('option');
        option.value = q;
        option.textContent = q;
        questionSelect.appendChild(option);
      });
    }

    document.getElementById('questionSelect').addEventListener('change', function() {
      document.getElementById('userInput').value = this.value;
    });

    // Voice recognition
    let recognition;
    let isRecording = false;

    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'hi-IN';

      recognition.onstart = function() {
        isRecording = true;
        document.getElementById('voiceBtn').classList.add('recording');
      };

      recognition.onresult = function(event) {
        document.getElementById('userInput').value = event.results[0][0].transcript;
      };

      recognition.onend = function() {
        isRecording = false;
        document.getElementById('voiceBtn').classList.remove('recording');
      };

      recognition.onerror = function() {
        isRecording = false;
        document.getElementById('voiceBtn').classList.remove('recording');
      };
    }

    document.getElementById('voiceBtn').addEventListener('click', function(e) {
      e.preventDefault();
      if (recognition) {
        if (isRecording) {
          recognition.stop();
        } else {
          recognition.start();
        }
      } else {
        alert('Voice recognition not supported');
      }
    });

    document.getElementById('submitBtn').addEventListener('click', async function() {
      const question = document.getElementById('userInput').value.trim();
      
      if (!question) {
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç! / Please enter your question!');
        return;
      }
      
      // Profile is always selected (default: citizen) so no need to validate
      // But show a gentle reminder if user hasn't explicitly selected
      if (selectedUser === 'citizen' && !document.getElementById('userCitizenMain').classList.contains('selected')) {
        console.log('‚ÑπÔ∏è Using default profile: General Citizen');
      }
      
      // Reset for new question
      currentQuestion = question;
      currentAnswerLevel = 'standard'; // Default to standard
      aiUsed = { groq: true, chatgpt: false, gemini: false };
      
      // Always use Groq first (fastest) with standard depth
      await getAnswer('groq', 'standard');
    });

    document.getElementById('closeModal').addEventListener('click', function() {
      document.getElementById('aiModal').classList.add('hidden');
    });

    document.getElementById('closeBtn').addEventListener('click', function() {
      document.getElementById('aiModal').classList.add('hidden');
    });

    // WhatsApp Share Function
    function shareOnWhatsApp() {
      const question = document.getElementById('modalQuestion').textContent;
      const answer = document.getElementById('modalAnswer').textContent;
      
      const message = '*LawBot 2024 - New Criminal Laws*\n\n' +
                      '*Question:*\n' + question + '\n\n' +
                      '*Answer:*\n' + answer.substring(0, 400) + '...\n\n' +
                      'Get more info at LawBot 2024';
      
      const whatsappUrl = 'https://wa.me/?text=' + encodeURIComponent(message);
      window.open(whatsappUrl, '_blank');
      console.log('‚úÖ Shared on WhatsApp');
    }
    
    window.shareOnWhatsApp = shareOnWhatsApp;

    // Extract Section Numbers from Response
    function extractSectionNumbers(text) {
      const matches = text.match(/(BNSS|BNS|BSA)\s*(?:Section)?\s*(\d+)/gi);
      if (!matches) return [];
      
      const sections = [];
      matches.forEach(function(m) {
        const parts = m.match(/(BNSS|BNS|BSA)\s*(?:Section)?\s*(\d+)/i);
        if (parts) {
          sections.push({ law: parts[1], section: parts[2] });
        }
      });
      return sections;
    }

    // Open Section Search with Parameters
    function openSectionSearch() {
      const answer = document.getElementById('modalAnswer').textContent;
      const sections = extractSectionNumbers(answer);
      
      if (sections.length > 0) {
        const params = sections.map(function(s) {
          return s.law + '-' + s.section;
        }).join(',');
        window.open('section-search.html?sections=' + params, '_blank');
        console.log('‚úÖ Opening section search with:', params);
      } else {
        window.open('section-search.html', '_blank');
        console.log('‚úÖ Opening section search (no sections found)');
      }
    }
    
    window.openSectionSearch = openSectionSearch;

    console.log('‚úÖ LawBot Topic-Based ready!');
  </script>

</body>
</html>
